{"version":3,"sources":["webpack:///peer.io.js","webpack:///webpack/bootstrap 249e88c7322f8a6feb15","webpack:///external \"eventemitter2\"","webpack:///./src/states/peerjs_state.ts","webpack:///./src/peer.io.ts","webpack:///./src/Util.ts","webpack:///./src/states/offline_state.ts","webpack:///external \"lodash\"","webpack:///./src/neighbour_record.ts","webpack:///./src/states/connected_state.ts","webpack:///./src/states/online_state.ts","webpack:///./src/link_component.ts","webpack:///./src/link_generator.ts","webpack:///./src/neighbour_store.ts","webpack:///./src/states/wait_closing_state.ts","webpack:///./bower_components/offline/offline.min.js"],"names":["exports","modules","__webpack_require__","moduleId","installedModules","module","id","loaded","call","m","c","p","require","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","offline_state_1","eventemitter2_1","PeerJsStateEnum","PeerJsStateManager","_eventemitter2_1$Even","this","_this","getPrototypeOf","_ON_STATE_CHANGED","_state","state","emit","callback","on","EventEmitter2","neighbour_record_1","neighbour_store_1","link_generator_1","_","NeighbourTypeEnum","OnStartVideo","OnStopVideo","OnDataLinkUp","OnDataLinkDown","OnRecvData","PeerIo","peerJs_","newDataChannel_","link","neighbourStore_","addLink","peerID","options","data","newMediaStream_","stream","linkGenerator_","addNeighbourSource","neighbours","OnNewDataChannel","OnNewMediaStream","NEED_ESTABLISH_LINK","establishLink","mediaStream","setDefaultStream","peerId","neighbour","NeighbourRecord","video","setStream","addRecord","option","setDataChannelOption","removeRecord","message","findLink","send","links","each","peer_io_1","Util","min","max","Math","random","type","hasOwnProperty","peerjs_state_1","online_state_1","OfflineState","initial","isOnline","setStateObject","isConnected","Util_1","peerId_","type_","sources_","option_","label","serialization","reliable","isEstablished","console","log","Array","getVideoTracks","push","apply","isMediaStream","wait_closing_state_1","ConnectedState","connected","connected_state_1","OnlineState","online","LinkComponentTemplate","peerID_","link_","DataLinkComponent","_LinkComponentTemplat","_this2","error","open","close","metadata","VideoLinkComponent","_LinkComponentTemplat2","_this3","_sources","source","LinkComponentFactory","isDataChannel","isMediaConnection","link_component_1","LinkGenerator","peer_","NeighbourSourceHash_","onStateChanged_","disconnected","state_","stateObject","peer","setTimeout","_establishAllPeer","waitTime","wait_closing","tryCall_","tryConnect_","targetNeighbours_","onRecvCall_","mediaConnection","neighbourID","findNeighbour_","retStream","defaultStream_","streams","answer","createLinkComponent","onRecvConnect_","dataConnection","onStateChanged","checkNetworkStatus_","wrapPeerEvent_","Offline","checks","xhr","url","network","check","err","find","item","reduce","container","val","innerContainer","record","concat","neighbourArray_","filter","_this4","_this5","connect","dataChannelOption","NeighbourStore","recordsHash_","linksHash_","isEstablished_","bind","addLink_","addRecord_","WaitClosingState","_typeof","Symbol","iterator","obj","a","b","d","e","f","g","window","Date","getTime","timeout","image","active","checkOnLoad","interceptRequests","reconnect","deDupBody","h","split","getOption","addEventListener","confirmUp","confirmDown","markUp","trigger","markDown","j","off","splice","_b","status","onprogress","onerror","arguments","ontimeout","onload","onreadystatechange","readyState","XMLHttpRequest","offline","document","createElement","src","down","up","onXHR","async","flags","user","password","setRequestHeader","headers","overrideMimeType","mimeType","XDomainRequest","undefined","Error","remaining","delay","ceil","setInterval","clearInterval","tryNow","body","abort","replace","toString","JSON","stringify","toUpperCase","requests","flush","clear","querySelector","localStorage","OFFLINE_SIMULATE","k","l","innerHTML","children","className","RegExp","join","clearTimeout","day","hour","minute","second","floor","appendChild","preventDefault","attachEvent","setAttribute"],"mappings":"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","file":"peer.io.js","sourcesContent":["exports[\"PeerIo\"] =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"dist/npm\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(14);\n\tmodule.exports = __webpack_require__(3);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"eventemitter2\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// NetworkのOn/Off, PeerJsのcon/disconnect, neighbourへの接続要求を管理するstate\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/tsd.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t(function (PeerJsStateEnum) {\n\t    PeerJsStateEnum[PeerJsStateEnum[\"initial\"] = 1] = \"initial\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"online\"] = 2] = \"online\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"connected\"] = 3] = \"connected\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"wait_closing\"] = 4] = \"wait_closing\";\n\t})(exports.PeerJsStateEnum || (exports.PeerJsStateEnum = {}));\n\tvar PeerJsStateEnum = exports.PeerJsStateEnum;\n\t\n\tvar PeerJsStateManager = function (_eventemitter2_1$Even) {\n\t    _inherits(PeerJsStateManager, _eventemitter2_1$Even);\n\t\n\t    function PeerJsStateManager() {\n\t        _classCallCheck(this, PeerJsStateManager);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(PeerJsStateManager).call(this));\n\t\n\t        _this._ON_STATE_CHANGED = \"onStateCahnged\";\n\t        _this._state = new offline_state_1.default();\n\t        return _this;\n\t    }\n\t\n\t    _createClass(PeerJsStateManager, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return this._state.state();\n\t        }\n\t    }, {\n\t        key: 'stateObject',\n\t        value: function stateObject() {\n\t            return this._state;\n\t        }\n\t    }, {\n\t        key: 'setStateObject',\n\t        value: function setStateObject(state) {\n\t            this._state = state;\n\t            this.emit(this._ON_STATE_CHANGED, state.state());\n\t        }\n\t    }, {\n\t        key: 'onStateChanged',\n\t        value: function onStateChanged(callback) {\n\t            this.on(this._ON_STATE_CHANGED, callback);\n\t        }\n\t    }]);\n\t\n\t    return PeerJsStateManager;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.PeerJsStateManager = PeerJsStateManager;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// Main Controller\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar neighbour_record_1 = __webpack_require__(7);\n\tvar neighbour_store_1 = __webpack_require__(12);\n\tvar link_generator_1 = __webpack_require__(11);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t(function (NeighbourTypeEnum) {\n\t    NeighbourTypeEnum[NeighbourTypeEnum[\"video\"] = 1] = \"video\";\n\t    NeighbourTypeEnum[NeighbourTypeEnum[\"data\"] = 2] = \"data\";\n\t})(exports.NeighbourTypeEnum || (exports.NeighbourTypeEnum = {}));\n\tvar NeighbourTypeEnum = exports.NeighbourTypeEnum;\n\texports.OnStartVideo = \"onStartVideo-in-peer.io.ts\";\n\texports.OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n\texports.OnDataLinkUp = \"onDataLinkUp\";\n\texports.OnDataLinkDown = \"onDataLinkDown\";\n\texports.OnRecvData = \"onRecvData\";\n\t\n\tvar PeerIo = function (_eventemitter2_1$Even) {\n\t    _inherits(PeerIo, _eventemitter2_1$Even);\n\t\n\t    //================= setup ==================\n\t\n\t    function PeerIo(peerJs_) {\n\t        _classCallCheck(this, PeerIo);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(PeerIo).call(this));\n\t\n\t        _this.peerJs_ = peerJs_;\n\t        _this.newDataChannel_ = function (link) {\n\t            _this.neighbourStore_.addLink(link);\n\t            _this.emit(exports.OnDataLinkUp, link.peerID(), link.options());\n\t            link.on(link.OnRecvData, function (data) {\n\t                _this.emit(exports.OnRecvData, link.peerID(), data);\n\t            });\n\t            link.on(link.OnDataLinkDown, function () {\n\t                _this.emit(exports.OnStopVideo, link.peerID());\n\t            });\n\t        };\n\t        _this.newMediaStream_ = function (link, stream) {\n\t            _this.neighbourStore_.addLink(link);\n\t            _this.emit(exports.OnStartVideo, link.peerID(), stream);\n\t            link.on(link.OnStopVideo, function () {\n\t                _this.emit(exports.OnStopVideo, link.peerID());\n\t            });\n\t        };\n\t        _this.neighbourStore_ = new neighbour_store_1.default();\n\t        _this.linkGenerator_ = new link_generator_1.default(peerJs_);\n\t        _this.linkGenerator_.addNeighbourSource(\"neighbourSource\", _this.neighbourStore_.neighbours);\n\t        _this.linkGenerator_.on(_this.linkGenerator_.OnNewDataChannel, _this.newDataChannel_);\n\t        _this.linkGenerator_.on(_this.linkGenerator_.OnNewMediaStream, _this.newMediaStream_);\n\t        _this.neighbourStore_.on(_this.neighbourStore_.NEED_ESTABLISH_LINK, _this.linkGenerator_.establishLink);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(PeerIo, [{\n\t        key: 'addDefaultStream',\n\t        value: function addDefaultStream(mediaStream) {\n\t            this.linkGenerator_.setDefaultStream(mediaStream);\n\t        }\n\t    }, {\n\t        key: 'addVideoNeighbour',\n\t        value: function addVideoNeighbour(peerId, stream) {\n\t            var neighbour = new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.video);\n\t            if (stream) neighbour.setStream(stream);\n\t            this.neighbourStore_.addRecord(neighbour);\n\t        }\n\t    }, {\n\t        key: 'addDataNeighbour',\n\t        value: function addDataNeighbour(peerId, option) {\n\t            var neighbour = new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.data);\n\t            if (option) neighbour.setDataChannelOption(option);\n\t            this.neighbourStore_.addRecord(neighbour);\n\t        }\n\t    }, {\n\t        key: 'removeVideoNeighbour',\n\t        value: function removeVideoNeighbour(peerId) {\n\t            this.neighbourStore_.removeRecord(new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.video));\n\t        }\n\t    }, {\n\t        key: 'removeDataNeighbour',\n\t        value: function removeDataNeighbour(peerId) {\n\t            this.neighbourStore_.removeRecord(new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.data));\n\t        }\n\t        //================= setup ==================\n\t        //================= data channel ===========\n\t\n\t    }, {\n\t        key: 'send',\n\t        value: function send(peerId, message) {\n\t            var target = this.neighbourStore_.findLink(peerId + \"-data\");\n\t            if (target) target.send(message);\n\t        }\n\t    }, {\n\t        key: 'broadcast',\n\t        value: function broadcast(message) {\n\t            var neighbours = this.neighbourStore_.links();\n\t            _.each(neighbours, function (link) {\n\t                link.send(message);\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return PeerIo;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.PeerIo = PeerIo;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peer_io_1 = __webpack_require__(3);\n\t\n\tvar Util = function () {\n\t    function Util() {\n\t        _classCallCheck(this, Util);\n\t    }\n\t\n\t    _createClass(Util, null, [{\n\t        key: \"waitTime\",\n\t        value: function waitTime(min, max) {\n\t            return min + Math.random() * (max - min);\n\t        }\n\t    }, {\n\t        key: \"key\",\n\t        value: function key(peerID, type) {\n\t            switch (type) {\n\t                case peer_io_1.NeighbourTypeEnum.video:\n\t                    return peerID + \"-video\";\n\t                case peer_io_1.NeighbourTypeEnum.data:\n\t                    return peerID + \"-data\";\n\t            }\n\t        }\n\t    }, {\n\t        key: \"isDataChannel\",\n\t        value: function isDataChannel(link) {\n\t            return link && link.hasOwnProperty('reliable');\n\t        }\n\t    }, {\n\t        key: \"isMediaConnection\",\n\t        value: function isMediaConnection(link) {\n\t            return link && link.hasOwnProperty('localStream');\n\t        }\n\t    }, {\n\t        key: \"isMediaStream\",\n\t        value: function isMediaStream(stream) {\n\t            return stream && 'active' in stream && 'id' in stream;\n\t        }\n\t    }]);\n\t\n\t    return Util;\n\t}();\n\t\n\texports.Util = Util;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オフライン Peer確立なし 接続要求もなし\n\t// 初期状態\n\t\"use strict\";\n\t/// <reference path=\"../../typings/tsd.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar online_state_1 = __webpack_require__(9);\n\t\n\tvar OfflineState = function () {\n\t    function OfflineState() {\n\t        _classCallCheck(this, OfflineState);\n\t    }\n\t\n\t    _createClass(OfflineState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.initial;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (isOnline) state.setStateObject(new online_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            //オフライン状態でpeerjsのステータスは変わらないので無視\n\t        }\n\t    }]);\n\t\n\t    return OfflineState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = OfflineState;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//NeighbourRecord is just a record.\n\t//It shows an Neighbour which LinkGenerator should establish a link to.\n\t//1. This object is created when user add an Neighbour.\n\t//2. This object is destroyed when user remove it.\n\t//3. This object has some delegated method.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Util_1 = __webpack_require__(4);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t\n\tvar NeighbourRecord = function (_eventemitter2_1$Even) {\n\t    _inherits(NeighbourRecord, _eventemitter2_1$Even);\n\t\n\t    function NeighbourRecord(peerId_, type_) {\n\t        _classCallCheck(this, NeighbourRecord);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(NeighbourRecord).call(this));\n\t\n\t        _this.peerId_ = peerId_;\n\t        _this.type_ = type_;\n\t        _this.sources_ = [];\n\t        _this.option_ = {\n\t            label: 'json',\n\t            serialization: 'none',\n\t            reliable: false\n\t        };\n\t        //delegate\n\t        _this.isEstablished = function () {\n\t            //throw(\"this method should be overwrite.\");\n\t            return false;\n\t        };\n\t        //delegate\n\t        _this.addLink = function (link) {\n\t            throw \"this method should be overwrite.\";\n\t        };\n\t        console.log(\"create neighbour record \" + peerId_ + \" type \" + type_);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(NeighbourRecord, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return this.type_;\n\t        }\n\t    }, {\n\t        key: 'peerID',\n\t        value: function peerID() {\n\t            return this.peerId_;\n\t        }\n\t    }, {\n\t        key: 'streams',\n\t        value: function streams() {\n\t            return this.sources_;\n\t        }\n\t    }, {\n\t        key: 'setStream',\n\t        value: function setStream(stream) {\n\t            console.log('setstream');\n\t            if (stream instanceof Array) {\n\t                console.log(\"array\");\n\t                console.log(stream[0].getVideoTracks());\n\t                Array.prototype.push.apply(this.sources_, stream);\n\t            } else if (Util_1.Util.isMediaStream(stream)) {\n\t                console.log(\"stream\");\n\t                console.log(stream.getVideoTracks());\n\t                this.sources_.push(stream);\n\t            }\n\t        }\n\t    }, {\n\t        key: 'dataChannelOption',\n\t        value: function dataChannelOption() {\n\t            return this.option_;\n\t        }\n\t    }, {\n\t        key: 'setDataChannelOption',\n\t        value: function setDataChannelOption(option) {\n\t            this.option_ = option;\n\t        }\n\t    }, {\n\t        key: 'key',\n\t        value: function key() {\n\t            return Util_1.Util.key(this.peerId_, this.type_);\n\t        }\n\t    }]);\n\t\n\t    return NeighbourRecord;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.NeighbourRecord = NeighbourRecord;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/tsd.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar online_state_1 = __webpack_require__(9);\n\tvar wait_closing_state_1 = __webpack_require__(13);\n\t\n\tvar ConnectedState = function () {\n\t    function ConnectedState() {\n\t        _classCallCheck(this, ConnectedState);\n\t    }\n\t\n\t    _createClass(ConnectedState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.connected;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (!isOnline) state.setStateObject(new wait_closing_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (!isConnected) state.setStateObject(new online_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return ConnectedState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = ConnectedState;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/tsd.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar connected_state_1 = __webpack_require__(8);\n\t\n\tvar OnlineState = function () {\n\t    function OnlineState() {\n\t        _classCallCheck(this, OnlineState);\n\t    }\n\t\n\t    _createClass(OnlineState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.online;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (!isOnline) state.setStateObject(new offline_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (isConnected) state.setStateObject(new connected_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return OnlineState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = OnlineState;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//It is a component which wraps Link(MediaStream of DataChannel)\n\t//1. This object is created when Link is established.\n\t//2. This object is created only by LinkComponentFactory\n\t//3. When Link become down, this component is destroyed\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Util_1 = __webpack_require__(4);\n\tvar peer_io_1 = __webpack_require__(3);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t\n\tvar LinkComponentTemplate = function (_eventemitter2_1$Even) {\n\t    _inherits(LinkComponentTemplate, _eventemitter2_1$Even);\n\t\n\t    function LinkComponentTemplate(peerID_, link_) {\n\t        _classCallCheck(this, LinkComponentTemplate);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(LinkComponentTemplate).call(this));\n\t\n\t        _this.peerID_ = peerID_;\n\t        _this.link_ = link_;\n\t        _this.OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n\t        _this.OnDataLinkDown = \"onDataLinkDown-in-link_component.ts\";\n\t        _this.OnRecvData = \"onRecvData-in-link_component.ts\";\n\t        return _this;\n\t    }\n\t\n\t    _createClass(LinkComponentTemplate, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return null;\n\t        }\n\t    }, {\n\t        key: 'peerID',\n\t        value: function peerID() {\n\t            return this.peerID_;\n\t        }\n\t    }, {\n\t        key: 'key',\n\t        value: function key() {\n\t            return Util_1.Util.key(this.peerID_, this.type());\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            return false;\n\t        }\n\t    }, {\n\t        key: 'send',\n\t        value: function send(message) {}\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {}\n\t    }]);\n\t\n\t    return LinkComponentTemplate;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.LinkComponentTemplate = LinkComponentTemplate;\n\t\n\tvar DataLinkComponent = function (_LinkComponentTemplat) {\n\t    _inherits(DataLinkComponent, _LinkComponentTemplat);\n\t\n\t    function DataLinkComponent(peerID_, link_) {\n\t        _classCallCheck(this, DataLinkComponent);\n\t\n\t        var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(DataLinkComponent).call(this, peerID_, link_));\n\t\n\t        _this2.peerID_ = peerID_;\n\t        _this2.link_ = link_;\n\t        link_.on('close', function () {\n\t            _this2.link_ = null;\n\t            _this2.emit(_this2.OnDataLinkDown);\n\t        });\n\t        link_.on('error', function (error) {\n\t            _this2.link_ = null;\n\t        });\n\t        link_.on('data', function (data) {\n\t            _this2.emit(_this2.OnRecvData, data);\n\t        });\n\t        return _this2;\n\t    }\n\t\n\t    _createClass(DataLinkComponent, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return peer_io_1.NeighbourTypeEnum.data;\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            if (!this.link_) return false;\n\t            if (!this.link_.open) return false;\n\t            return this.link_.open;\n\t        }\n\t    }, {\n\t        key: 'send',\n\t        value: function send(message) {\n\t            if (!this.isEstablished() || !this.link_) return;\n\t            this.link_.send(message);\n\t        }\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {\n\t            if (this.link_) this.link_.close();\n\t            this.link_ = null;\n\t        }\n\t    }, {\n\t        key: 'options',\n\t        value: function options() {\n\t            return {\n\t                metadata: this.link_.metadata,\n\t                serialization: this.link_.serialization,\n\t                reliable: this.link_.reliable\n\t            };\n\t        }\n\t    }]);\n\t\n\t    return DataLinkComponent;\n\t}(LinkComponentTemplate);\n\t\n\texports.DataLinkComponent = DataLinkComponent;\n\t\n\tvar VideoLinkComponent = function (_LinkComponentTemplat2) {\n\t    _inherits(VideoLinkComponent, _LinkComponentTemplat2);\n\t\n\t    function VideoLinkComponent(peerID_, link_) {\n\t        _classCallCheck(this, VideoLinkComponent);\n\t\n\t        var _this3 = _possibleConstructorReturn(this, Object.getPrototypeOf(VideoLinkComponent).call(this, peerID_, link_));\n\t\n\t        _this3.peerID_ = peerID_;\n\t        _this3.link_ = link_;\n\t        _this3._sources = [];\n\t        link_.on('close', function () {\n\t            _this3.link_ = null;\n\t            _this3.emit(_this3.OnStopVideo);\n\t        });\n\t        link_.on('error', function (error) {\n\t            _this3.link_ = null;\n\t        });\n\t        return _this3;\n\t    }\n\t\n\t    _createClass(VideoLinkComponent, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return peer_io_1.NeighbourTypeEnum.video;\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            if (!this.link_) return false;\n\t            if (!this.link_.open) return false;\n\t            return this.link_.open;\n\t        }\n\t    }, {\n\t        key: 'sources',\n\t        value: function sources() {\n\t            return this._sources;\n\t        }\n\t    }, {\n\t        key: 'setSource',\n\t        value: function setSource(source) {\n\t            if (source instanceof Array) Array.prototype.push.apply(this._sources, source);else this._sources.push(source);\n\t        }\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {\n\t            if (this.link_) this.link_.close();\n\t            this.link_ = null;\n\t        }\n\t    }]);\n\t\n\t    return VideoLinkComponent;\n\t}(LinkComponentTemplate);\n\t\n\texports.VideoLinkComponent = VideoLinkComponent;\n\t\n\tvar LinkComponentFactory = function () {\n\t    function LinkComponentFactory() {\n\t        _classCallCheck(this, LinkComponentFactory);\n\t    }\n\t\n\t    _createClass(LinkComponentFactory, null, [{\n\t        key: 'createLinkComponent',\n\t        value: function createLinkComponent(peerID, link) {\n\t            if (Util_1.Util.isDataChannel(link)) {\n\t                return new DataLinkComponent(peerID, link);\n\t            } else if (Util_1.Util.isMediaConnection(link)) {\n\t                return new VideoLinkComponent(peerID, link);\n\t            }\n\t            return null;\n\t        }\n\t    }]);\n\t\n\t    return LinkComponentFactory;\n\t}();\n\t\n\texports.LinkComponentFactory = LinkComponentFactory;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//LinkGenerator wraps PeerJs object and establish P2P Link\n\t//1. This object is created when PeerIo is initialized\n\t//2. This object is destroyed when PeerIo destroyed\n\t//3. This object may be unique, I'll make it singleton.A\n\t//4. This object has a State object that shows Online/Offline/PeerJsConnected status.\n\t//5. This object doesn't have any Neighbour's information.\n\t//    This object gets it through a delegate method in NeighbourSourceArray_\n\t//5. When client become online, it try to establish P2P link.\n\t//6. When Neighbour request this client to establish Link,\n\t//    this object create link object and hold it until 'onopen' event is fired.\n\t//7. When 'onopen' event is fired, it creates LinkComponent object and pass it to NeighbourStore object.\n\t//    NeighbourStore object may accept and decline this link.\n\t//    LinkGenerator doesn't care for it.\n\t//8. This object doesn't close Link. It only generates it.\n\t//9. This object has some streams to answer to requests from Neighbour.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar link_component_1 = __webpack_require__(10);\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar Util_1 = __webpack_require__(4);\n\tvar peer_io_1 = __webpack_require__(3);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t\n\tvar LinkGenerator = function (_eventemitter2_1$Even) {\n\t    _inherits(LinkGenerator, _eventemitter2_1$Even);\n\t\n\t    function LinkGenerator(peer_) {\n\t        _classCallCheck(this, LinkGenerator);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(LinkGenerator).call(this));\n\t\n\t        _this.peer_ = peer_;\n\t        _this.OnNewMediaStream = \"on-new-mediastream-in-link_generator.ts\";\n\t        _this.OnNewDataChannel = \"on-new-datachannel-in-link_generator.ts\";\n\t        _this.NeighbourSourceHash_ = {};\n\t        _this.onStateChanged_ = function (state) {\n\t            switch (state) {\n\t                case peerjs_state_1.PeerJsStateEnum.initial:\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.online:\n\t                    if (!_this.peer_.disconnected) {\n\t                        _this.state_.stateObject().peer(_this.state_, true);\n\t                    }\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.connected:\n\t                    setTimeout(_this._establishAllPeer, Util_1.Util.waitTime(2000, 5000));\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.wait_closing:\n\t                    break;\n\t                default:\n\t                    break;\n\t            }\n\t        };\n\t        //=============peer event and change state end===========\n\t        //=============Link generation methods start===========\n\t        _this.establishLink = function (neighbour) {\n\t            switch (neighbour.type()) {\n\t                case peer_io_1.NeighbourTypeEnum.video:\n\t                    _this.tryCall_(neighbour);\n\t                    break;\n\t                case peer_io_1.NeighbourTypeEnum.data:\n\t                    _this.tryConnect_(neighbour);\n\t                    break;\n\t            }\n\t        };\n\t        _this._establishAllPeer = function () {\n\t            _.each(_this.targetNeighbours_(), _this.establishLink);\n\t        };\n\t        _this.onRecvCall_ = function (mediaConnection) {\n\t            var neighbourID = mediaConnection.peer;\n\t            var neighbour = _this.findNeighbour_(Util_1.Util.key(neighbourID, peer_io_1.NeighbourTypeEnum.video));\n\t            var retStream = _this.defaultStream_;\n\t            if (neighbour) {\n\t                var streams = neighbour.streams();\n\t                if (streams && streams.length > 0) {\n\t                    retStream = streams[0];\n\t                }\n\t            }\n\t            mediaConnection.answer(retStream);\n\t            mediaConnection.on(\"stream\", function (stream) {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbourID, mediaConnection);\n\t                _this.emit(_this.OnNewMediaStream, link, stream);\n\t            });\n\t        };\n\t        _this.onRecvConnect_ = function (dataConnection) {\n\t            var neighbourID = dataConnection.peer;\n\t            dataConnection.on('open', function () {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbourID, dataConnection);\n\t                _this.emit(_this.OnNewDataChannel, link);\n\t            });\n\t        };\n\t        _this.state_ = new peerjs_state_1.PeerJsStateManager();\n\t        _this.state_.onStateChanged(_this.onStateChanged_);\n\t        _this.checkNetworkStatus_();\n\t        _this.wrapPeerEvent_();\n\t        return _this;\n\t    }\n\t\n\t    _createClass(LinkGenerator, [{\n\t        key: 'setDefaultStream',\n\t        value: function setDefaultStream(stream) {\n\t            this.defaultStream_ = stream;\n\t        }\n\t    }, {\n\t        key: 'addNeighbourSource',\n\t        value: function addNeighbourSource(key, source) {\n\t            this.NeighbourSourceHash_[key] = source;\n\t        }\n\t    }, {\n\t        key: 'removeNeighbourSource',\n\t        value: function removeNeighbourSource(key) {\n\t            if (key in this.NeighbourSourceHash_) delete this.NeighbourSourceHash_[key];\n\t        }\n\t        //=============Network and PeerJs state methods start=========\n\t\n\t    }, {\n\t        key: 'checkNetworkStatus_',\n\t        value: function checkNetworkStatus_() {\n\t            var _this2 = this;\n\t\n\t            Offline.options = { checks: { xhr: { url: 'https://skyway.io/dist/0.3/peer.min.js' } } };\n\t            Offline.on('up', function () {\n\t                _this2.state_.stateObject().network(_this2.state_, true);\n\t            });\n\t            Offline.on('down', function () {\n\t                _this2.state_.stateObject().network(_this2.state_, false);\n\t            });\n\t            if (Offline.state === 'up') {\n\t                this.state_.stateObject().network(this.state_, true);\n\t            }\n\t            Offline.check();\n\t        }\n\t    }, {\n\t        key: 'wrapPeerEvent_',\n\t        value: function wrapPeerEvent_() {\n\t            var _this3 = this;\n\t\n\t            this.peer_.on(\"open\", function () {\n\t                _this3.state_.stateObject().peer(_this3.state_, true);\n\t            });\n\t            this.peer_.on('error', function (err) {\n\t                console.log(err);\n\t            });\n\t            this.peer_.on('disconnected', function () {\n\t                _this3.state_.stateObject().peer(_this3.state_, false);\n\t            });\n\t            this.peer_.on('connection', this.onRecvConnect_);\n\t            this.peer_.on('call', this.onRecvCall_);\n\t        }\n\t    }, {\n\t        key: 'findNeighbour_',\n\t        value: function findNeighbour_(key) {\n\t            var source = _.find(this.NeighbourSourceHash_, function (item) {\n\t                return key in item();\n\t            });\n\t            if (source) return source()[key];\n\t            return null;\n\t        }\n\t    }, {\n\t        key: 'neighbourArray_',\n\t        value: function neighbourArray_() {\n\t            return _.reduce(this.NeighbourSourceHash_, function (container, val, key) {\n\t                return _.reduce(val(), function (innerContainer, record, key) {\n\t                    return innerContainer.concat(record);\n\t                }, container);\n\t            }, []);\n\t        }\n\t    }, {\n\t        key: 'targetNeighbours_',\n\t        value: function targetNeighbours_() {\n\t            var neighbours = this.neighbourArray_();\n\t            return _.filter(neighbours, function (neighbour) {\n\t                return !neighbour.isEstablished();\n\t            });\n\t        }\n\t    }, {\n\t        key: 'tryCall_',\n\t        value: function tryCall_(neighbour) {\n\t            var _this4 = this;\n\t\n\t            var streams = neighbour.streams();\n\t            var retStream = this.defaultStream_;\n\t            if (streams && streams.length > 0) retStream = streams[0];\n\t            var mediaConnection = this.peer_.call(neighbour.peerID(), retStream);\n\t            if (!mediaConnection) return;\n\t            mediaConnection.on(\"stream\", function (stream) {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbour.peerID(), mediaConnection);\n\t                _this4.emit(_this4.OnNewMediaStream, link, stream);\n\t            });\n\t        }\n\t    }, {\n\t        key: 'tryConnect_',\n\t        value: function tryConnect_(neighbour) {\n\t            var _this5 = this;\n\t\n\t            var dataConnection = this.peer_.connect(neighbour.peerID(), neighbour.dataChannelOption());\n\t            if (!dataConnection) return;\n\t            dataConnection.on('open', function () {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbour.peerID(), dataConnection);\n\t                _this5.emit(_this5.OnNewDataChannel, link);\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return LinkGenerator;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = LinkGenerator;\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//NeighbourStore has records and links\n\t//1. This object is created when PeerIo is initialized\n\t//2. This object is destroyed when PeerIo destroyed\n\t//3. This object may be unique, I'll make it singleton.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar neighbour_record_1 = __webpack_require__(7);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t\n\tvar NeighbourStore = function (_eventemitter2_1$Even) {\n\t    _inherits(NeighbourStore, _eventemitter2_1$Even);\n\t\n\t    function NeighbourStore() {\n\t        _classCallCheck(this, NeighbourStore);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(NeighbourStore).call(this));\n\t\n\t        _this.NEED_ESTABLISH_LINK = \"need-establish-link-in-neighbourstore\";\n\t        _this.recordsHash_ = {};\n\t        _this.linksHash_ = {};\n\t        _this.neighbours = function () {\n\t            return _this.recordsHash_;\n\t        };\n\t        return _this;\n\t    }\n\t\n\t    _createClass(NeighbourStore, [{\n\t        key: 'addRecord_',\n\t        value: function addRecord_(record) {\n\t            record.isEstablished = this.isEstablished_.bind(this, record.key());\n\t            record.addLink = this.addLink_.bind(this, record.key());\n\t            this.recordsHash_[record.key()] = record;\n\t        }\n\t    }, {\n\t        key: 'addRecord',\n\t        value: function addRecord(record) {\n\t            if (record.key() in this.recordsHash_) {\n\t                if (this.recordsHash_[record.key()].isEstablished()) {} else {\n\t                    this.emit(this.NEED_ESTABLISH_LINK, this.recordsHash_[record.key()]);\n\t                }\n\t            } else {\n\t                this.addRecord_(record);\n\t                this.emit(this.NEED_ESTABLISH_LINK, record);\n\t            }\n\t        }\n\t    }, {\n\t        key: 'removeRecord',\n\t        value: function removeRecord(record) {\n\t            if (record.key() in this.linksHash_) {\n\t                this.linksHash_[record.key()].close();\n\t                delete this.linksHash_[record.key()];\n\t            }\n\t            if (record.key() in this.recordsHash_) {\n\t                delete this.recordsHash_[record.key()];\n\t            }\n\t        }\n\t    }, {\n\t        key: 'addLink',\n\t        value: function addLink(link) {\n\t            if (!(link.key() in this.recordsHash_)) {\n\t                var record = new neighbour_record_1.NeighbourRecord(link.peerID(), link.type());\n\t                this.addRecord_(record);\n\t            }\n\t            this.linksHash_[link.key()] = link;\n\t        }\n\t    }, {\n\t        key: 'findLink',\n\t        value: function findLink(key) {\n\t            return this.linksHash_[key];\n\t        }\n\t    }, {\n\t        key: 'links',\n\t        value: function links() {\n\t            return _.reduce(this.linksHash_, function (innerContainer, record, key) {\n\t                return innerContainer.concat(record);\n\t            }, []);\n\t        }\n\t    }, {\n\t        key: 'addLink_',\n\t        value: function addLink_(key, link) {\n\t            if (this.isEstablished_(key)) this.linksHash_[key].close();\n\t            this.linksHash_[key] = link;\n\t        }\n\t    }, {\n\t        key: 'isEstablished_',\n\t        value: function isEstablished_(key) {\n\t            if (!(key in this.linksHash_)) return false;\n\t            return this.linksHash_[key].isEstablished();\n\t        }\n\t    }]);\n\t\n\t    return NeighbourStore;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = NeighbourStore;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/tsd.d.ts\" />\n\t/// <reference path=\"./peerjs_state.ts\" />\n\t/// <reference path=\"./offline_state.ts\" />\n\t/// <reference path=\"./connected_state.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar connected_state_1 = __webpack_require__(8);\n\t\n\tvar WaitClosingState = function () {\n\t    function WaitClosingState() {\n\t        _classCallCheck(this, WaitClosingState);\n\t    }\n\t\n\t    _createClass(WaitClosingState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.wait_closing;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (isOnline) state.setStateObject(new connected_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (!isConnected) state.setStateObject(new offline_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return WaitClosingState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = WaitClosingState;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t/*! offline-js 0.7.14 */\n\t(function () {\n\t  var a, b, c, d, e, f, g;d = function d(a, b) {\n\t    var c, d, e, f;e = [];for (d in b.prototype) {\n\t      try {\n\t        f = b.prototype[d], null == a[d] && \"function\" != typeof f ? e.push(a[d] = f) : e.push(void 0);\n\t      } catch (g) {\n\t        c = g;\n\t      }\n\t    }return e;\n\t  }, a = {}, a.options = window.Offline ? window.Offline.options || {} : {}, c = { checks: { xhr: { url: function url() {\n\t          return \"/favicon.ico?_=\" + new Date().getTime();\n\t        }, timeout: 5e3, type: \"HEAD\" }, image: { url: function url() {\n\t          return \"/favicon.ico?_=\" + new Date().getTime();\n\t        } }, active: \"xhr\" }, checkOnLoad: !1, interceptRequests: !0, reconnect: !0, deDupBody: !1 }, e = function e(a, b) {\n\t    var c, d, e, f, g, h;for (c = a, h = b.split(\".\"), d = e = 0, f = h.length; f > e && (g = h[d], c = c[g], \"object\" == (typeof c === \"undefined\" ? \"undefined\" : _typeof(c))); d = ++e) {}return d === h.length - 1 ? c : void 0;\n\t  }, a.getOption = function (b) {\n\t    var d, f;return f = null != (d = e(a.options, b)) ? d : e(c, b), \"function\" == typeof f ? f() : f;\n\t  }, \"function\" == typeof window.addEventListener && window.addEventListener(\"online\", function () {\n\t    return setTimeout(a.confirmUp, 100);\n\t  }, !1), \"function\" == typeof window.addEventListener && window.addEventListener(\"offline\", function () {\n\t    return a.confirmDown();\n\t  }, !1), a.state = \"up\", a.markUp = function () {\n\t    return a.trigger(\"confirmed-up\"), \"up\" !== a.state ? (a.state = \"up\", a.trigger(\"up\")) : void 0;\n\t  }, a.markDown = function () {\n\t    return a.trigger(\"confirmed-down\"), \"down\" !== a.state ? (a.state = \"down\", a.trigger(\"down\")) : void 0;\n\t  }, f = {}, a.on = function (b, c, d) {\n\t    var e, g, h, i, j;if (g = b.split(\" \"), g.length > 1) {\n\t      for (j = [], h = 0, i = g.length; i > h; h++) {\n\t        e = g[h], j.push(a.on(e, c, d));\n\t      }return j;\n\t    }return null == f[b] && (f[b] = []), f[b].push([d, c]);\n\t  }, a.off = function (a, b) {\n\t    var c, d, e, g, h;if (null != f[a]) {\n\t      if (b) {\n\t        for (e = 0, h = []; e < f[a].length;) {\n\t          g = f[a][e], d = g[0], c = g[1], c === b ? h.push(f[a].splice(e, 1)) : h.push(e++);\n\t        }return h;\n\t      }return f[a] = [];\n\t    }\n\t  }, a.trigger = function (a) {\n\t    var b, c, d, e, g, h, i;if (null != f[a]) {\n\t      for (g = f[a], i = [], d = 0, e = g.length; e > d; d++) {\n\t        h = g[d], b = h[0], c = h[1], i.push(c.call(b));\n\t      }return i;\n\t    }\n\t  }, b = function b(a, _b, c) {\n\t    var d, e, f, g, h;return h = function h() {\n\t      return a.status && a.status < 12e3 ? _b() : c();\n\t    }, null === a.onprogress ? (d = a.onerror, a.onerror = function () {\n\t      return c(), \"function\" == typeof d ? d.apply(null, arguments) : void 0;\n\t    }, g = a.ontimeout, a.ontimeout = function () {\n\t      return c(), \"function\" == typeof g ? g.apply(null, arguments) : void 0;\n\t    }, e = a.onload, a.onload = function () {\n\t      return h(), \"function\" == typeof e ? e.apply(null, arguments) : void 0;\n\t    }) : (f = a.onreadystatechange, a.onreadystatechange = function () {\n\t      return 4 === a.readyState ? h() : 0 === a.readyState && c(), \"function\" == typeof f ? f.apply(null, arguments) : void 0;\n\t    });\n\t  }, a.checks = {}, a.checks.xhr = function () {\n\t    var c, d;d = new XMLHttpRequest(), d.offline = !1, d.open(a.getOption(\"checks.xhr.type\"), a.getOption(\"checks.xhr.url\"), !0), null != d.timeout && (d.timeout = a.getOption(\"checks.xhr.timeout\")), b(d, a.markUp, a.markDown);try {\n\t      d.send();\n\t    } catch (e) {\n\t      c = e, a.markDown();\n\t    }return d;\n\t  }, a.checks.image = function () {\n\t    var b;return b = document.createElement(\"img\"), b.onerror = a.markDown, b.onload = a.markUp, void (b.src = a.getOption(\"checks.image.url\"));\n\t  }, a.checks.down = a.markDown, a.checks.up = a.markUp, a.check = function () {\n\t    return a.trigger(\"checking\"), a.checks[a.getOption(\"checks.active\")]();\n\t  }, a.confirmUp = a.confirmDown = a.check, a.onXHR = function (a) {\n\t    var b, c, e;return e = function e(b, c) {\n\t      var d;return d = b.open, b.open = function (e, f, g, h, i) {\n\t        return a({ type: e, url: f, async: g, flags: c, user: h, password: i, xhr: b }), d.apply(b, arguments);\n\t      };\n\t    }, c = window.XMLHttpRequest, window.XMLHttpRequest = function (a) {\n\t      var b, d, f;return f = new c(a), e(f, a), d = f.setRequestHeader, f.headers = {}, f.setRequestHeader = function (a, b) {\n\t        return f.headers[a] = b, d.call(f, a, b);\n\t      }, b = f.overrideMimeType, f.overrideMimeType = function (a) {\n\t        return f.mimeType = a, b.call(f, a);\n\t      }, f;\n\t    }, d(window.XMLHttpRequest, c), null != window.XDomainRequest ? (b = window.XDomainRequest, window.XDomainRequest = function () {\n\t      var a;return a = new b(), e(a), a;\n\t    }, d(window.XDomainRequest, b)) : void 0;\n\t  }, g = function g() {\n\t    return a.getOption(\"interceptRequests\") && a.onXHR(function (c) {\n\t      var d;return d = c.xhr, d.offline !== !1 ? b(d, a.markUp, a.confirmDown) : void 0;\n\t    }), a.getOption(\"checkOnLoad\") ? a.check() : void 0;\n\t  }, setTimeout(g, 0), window.Offline = a;\n\t}).call(undefined), function () {\n\t  var a, b, c, d, e, f, g, h, i;if (!window.Offline) throw new Error(\"Offline Reconnect brought in without offline.js\");d = Offline.reconnect = {}, f = null, e = function e() {\n\t    var a;return null != d.state && \"inactive\" !== d.state && Offline.trigger(\"reconnect:stopped\"), d.state = \"inactive\", d.remaining = d.delay = null != (a = Offline.getOption(\"reconnect.initialDelay\")) ? a : 3;\n\t  }, b = function b() {\n\t    var a, b;return a = null != (b = Offline.getOption(\"reconnect.delay\")) ? b : Math.min(Math.ceil(1.5 * d.delay), 3600), d.remaining = d.delay = a;\n\t  }, g = function g() {\n\t    return \"connecting\" !== d.state ? (d.remaining -= 1, Offline.trigger(\"reconnect:tick\"), 0 === d.remaining ? h() : void 0) : void 0;\n\t  }, h = function h() {\n\t    return \"waiting\" === d.state ? (Offline.trigger(\"reconnect:connecting\"), d.state = \"connecting\", Offline.check()) : void 0;\n\t  }, a = function a() {\n\t    return Offline.getOption(\"reconnect\") ? (e(), d.state = \"waiting\", Offline.trigger(\"reconnect:started\"), f = setInterval(g, 1e3)) : void 0;\n\t  }, i = function i() {\n\t    return null != f && clearInterval(f), e();\n\t  }, c = function c() {\n\t    return Offline.getOption(\"reconnect\") && \"connecting\" === d.state ? (Offline.trigger(\"reconnect:failure\"), d.state = \"waiting\", b()) : void 0;\n\t  }, d.tryNow = h, e(), Offline.on(\"down\", a), Offline.on(\"confirmed-down\", c), Offline.on(\"up\", i);\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e, f;if (!window.Offline) throw new Error(\"Requests module brought in without offline.js\");c = [], f = !1, d = function d(a) {\n\t    return Offline.getOption(\"requests\") !== !1 ? (Offline.trigger(\"requests:capture\"), \"down\" !== Offline.state && (f = !0), c.push(a)) : void 0;\n\t  }, e = function e(a) {\n\t    var b, c, d, e, f, g, h, i, j;if (j = a.xhr, g = a.url, f = a.type, h = a.user, d = a.password, b = a.body, Offline.getOption(\"requests\") !== !1) {\n\t      j.abort(), j.open(f, g, !0, h, d), e = j.headers;for (c in e) {\n\t        i = e[c], j.setRequestHeader(c, i);\n\t      }return j.mimeType && j.overrideMimeType(j.mimeType), j.send(b);\n\t    }\n\t  }, a = function a() {\n\t    return c = [];\n\t  }, b = function b() {\n\t    var b, d, f, g, h, i, j;if (Offline.getOption(\"requests\") !== !1) {\n\t      for (Offline.trigger(\"requests:flush\"), i = {}, d = 0, g = c.length; g > d; d++) {\n\t        h = c[d], j = h.url.replace(/(\\?|&)_=[0-9]+/, function (a, b) {\n\t          return \"?\" === b ? b : \"\";\n\t        }), Offline.getOption(\"deDupBody\") ? (b = h.body, b = \"[object Object]\" === b.toString() ? JSON.stringify(b) : b.toString(), i[h.type.toUpperCase() + \" - \" + j + \" - \" + b] = h) : i[h.type.toUpperCase() + \" - \" + j] = h;\n\t      }for (f in i) {\n\t        h = i[f], e(h);\n\t      }return a();\n\t    }\n\t  }, setTimeout(function () {\n\t    return Offline.getOption(\"requests\") !== !1 ? (Offline.on(\"confirmed-up\", function () {\n\t      return f ? (f = !1, a()) : void 0;\n\t    }), Offline.on(\"up\", b), Offline.on(\"down\", function () {\n\t      return f = !1;\n\t    }), Offline.onXHR(function (a) {\n\t      var b, c, e, f, g;return g = a.xhr, e = a.async, g.offline !== !1 && (f = function f() {\n\t        return d(a);\n\t      }, c = g.send, g.send = function (b) {\n\t        return a.body = b, c.apply(g, arguments);\n\t      }, e) ? null === g.onprogress ? (g.addEventListener(\"error\", f, !1), g.addEventListener(\"timeout\", f, !1)) : (b = g.onreadystatechange, g.onreadystatechange = function () {\n\t        return 0 === g.readyState ? f() : 4 === g.readyState && (0 === g.status || g.status >= 12e3) && f(), \"function\" == typeof b ? b.apply(null, arguments) : void 0;\n\t      }) : void 0;\n\t    }), Offline.requests = { flush: b, clear: a }) : void 0;\n\t  }, 0);\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e;if (!Offline) throw new Error(\"Offline simulate brought in without offline.js\");for (d = [\"up\", \"down\"], b = 0, c = d.length; c > b; b++) {\n\t    e = d[b], (document.querySelector(\"script[data-simulate='\" + e + \"']\") || (\"undefined\" != typeof localStorage && null !== localStorage ? localStorage.OFFLINE_SIMULATE : void 0) === e) && (null == Offline.options && (Offline.options = {}), null == (a = Offline.options).checks && (a.checks = {}), Offline.options.checks.active = e);\n\t  }\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e, f, g, h, i, j, k, l, m;if (!window.Offline) throw new Error(\"Offline UI brought in without offline.js\");b = '<div class=\"offline-ui\"><div class=\"offline-ui-content\"></div></div>', a = '<a href class=\"offline-ui-retry\"></a>', f = function f(a) {\n\t    var b;return b = document.createElement(\"div\"), b.innerHTML = a, b.children[0];\n\t  }, g = e = null, d = function d(a) {\n\t    return k(a), g.className += \" \" + a;\n\t  }, k = function k(a) {\n\t    return g.className = g.className.replace(new RegExp(\"(^| )\" + a.split(\" \").join(\"|\") + \"( |$)\", \"gi\"), \" \");\n\t  }, i = {}, h = function h(a, b) {\n\t    return d(a), null != i[a] && clearTimeout(i[a]), i[a] = setTimeout(function () {\n\t      return k(a), delete i[a];\n\t    }, 1e3 * b);\n\t  }, m = function m(a) {\n\t    var b, c, d, e;d = { day: 86400, hour: 3600, minute: 60, second: 1 };for (c in d) {\n\t      if (b = d[c], a >= b) return e = Math.floor(a / b), [e, c];\n\t    }return [\"now\", \"\"];\n\t  }, l = function l() {\n\t    var c, h;return g = f(b), document.body.appendChild(g), null != Offline.reconnect && Offline.getOption(\"reconnect\") && (g.appendChild(f(a)), c = g.querySelector(\".offline-ui-retry\"), h = function h(a) {\n\t      return a.preventDefault(), Offline.reconnect.tryNow();\n\t    }, null != c.addEventListener ? c.addEventListener(\"click\", h, !1) : c.attachEvent(\"click\", h)), d(\"offline-ui-\" + Offline.state), e = g.querySelector(\".offline-ui-content\");\n\t  }, j = function j() {\n\t    return l(), Offline.on(\"up\", function () {\n\t      return k(\"offline-ui-down\"), d(\"offline-ui-up\"), h(\"offline-ui-up-2s\", 2), h(\"offline-ui-up-5s\", 5);\n\t    }), Offline.on(\"down\", function () {\n\t      return k(\"offline-ui-up\"), d(\"offline-ui-down\"), h(\"offline-ui-down-2s\", 2), h(\"offline-ui-down-5s\", 5);\n\t    }), Offline.on(\"reconnect:connecting\", function () {\n\t      return d(\"offline-ui-connecting\"), k(\"offline-ui-waiting\");\n\t    }), Offline.on(\"reconnect:tick\", function () {\n\t      var a, b, c;return d(\"offline-ui-waiting\"), k(\"offline-ui-connecting\"), a = m(Offline.reconnect.remaining), b = a[0], c = a[1], e.setAttribute(\"data-retry-in-value\", b), e.setAttribute(\"data-retry-in-unit\", c);\n\t    }), Offline.on(\"reconnect:stopped\", function () {\n\t      return k(\"offline-ui-connecting offline-ui-waiting\"), e.setAttribute(\"data-retry-in-value\", null), e.setAttribute(\"data-retry-in-unit\", null);\n\t    }), Offline.on(\"reconnect:failure\", function () {\n\t      return h(\"offline-ui-reconnect-failed-2s\", 2), h(\"offline-ui-reconnect-failed-5s\", 5);\n\t    }), Offline.on(\"reconnect:success\", function () {\n\t      return h(\"offline-ui-reconnect-succeeded-2s\", 2), h(\"offline-ui-reconnect-succeeded-5s\", 5);\n\t    });\n\t  }, \"complete\" === document.readyState ? j() : null != document.addEventListener ? document.addEventListener(\"DOMContentLoaded\", j, !1) : (c = document.onreadystatechange, document.onreadystatechange = function () {\n\t    return \"complete\" === document.readyState && j(), \"function\" == typeof c ? c.apply(null, arguments) : void 0;\n\t  });\n\t}.call(undefined);\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** peer.io.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist/npm\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 249e88c7322f8a6feb15\n **/","module.exports = require(\"eventemitter2\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"eventemitter2\"\n ** module id = 1\n ** module chunks = 0\n **/","// NetworkのOn/Off, PeerJsのcon/disconnect, neighbourへの接続要求を管理するstate\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/tsd.d.ts\" />\nimport OfflineState from './offline_state';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport enum PeerJsStateEnum{\n  initial = 1,\n  online = 2,\n  connected = 3,\n  wait_closing = 4\n}\n\nexport class PeerJsStateManager extends EventEmitter2{\n  private _state: PeerJsStateIf;\n  private _ON_STATE_CHANGED = \"onStateCahnged\";\n\n  constructor(){\n    super();\n    this._state = new OfflineState();\n  }\n\n  state(): PeerJsStateEnum{\n    return this._state.state();\n  }\n\n  stateObject(): PeerJsStateIf{\n    return this._state;\n  }\n\n  setStateObject(state: PeerJsStateIf){\n    this._state = state;\n    this.emit(this._ON_STATE_CHANGED, state.state());\n  }\n\n  onStateChanged(callback: (status: PeerJsStateEnum)=>void){\n    this.on(this._ON_STATE_CHANGED, callback);\n  }\n}\n\nexport interface PeerJsStateIf{\n  state(): PeerJsStateEnum;\n  network(state: PeerJsStateManager, isOnline: boolean): void;\n  peer(state: PeerJsStateManager, isConnected: boolean): void;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/peerjs_state.ts\n **/","// Main Controller\n\n/// <reference path=\"../typings/tsd.d.ts\" />\nimport {Util} from './Util';\nimport {NeighbourRecord, NeighbourSource, NeighbourHash} from './neighbour_record';\nimport NeighbourStore from './neighbour_store'\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport LinkGenerator from './link_generator';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport enum NeighbourTypeEnum{\n  video = 1,\n  data = 2\n}\n\nexport var OnStartVideo = \"onStartVideo-in-peer.io.ts\";\nexport var OnStopVideo = \"onStopVideo-in-peer.io.ts\";\nexport var OnDataLinkUp = \"onDataLinkUp\";\nexport var OnDataLinkDown = \"onDataLinkDown\";\nexport var OnRecvData = \"onRecvData\";\n\nexport class PeerIo extends EventEmitter2{\n  private linkGenerator_: LinkGenerator;\n  private neighbourStore_: NeighbourStore;\n\n  //================= setup ==================\n  constructor(private peerJs_: PeerJs.Peer){\n    super();\n    this.neighbourStore_ = new NeighbourStore();\n    this.linkGenerator_ = new LinkGenerator(peerJs_);\n    this.linkGenerator_.addNeighbourSource(\"neighbourSource\", this.neighbourStore_.neighbours);\n    this.linkGenerator_.on(this.linkGenerator_.OnNewDataChannel, this.newDataChannel_);\n    this.linkGenerator_.on(this.linkGenerator_.OnNewMediaStream, this.newMediaStream_);\n    this.neighbourStore_.on(this.neighbourStore_.NEED_ESTABLISH_LINK, this.linkGenerator_.establishLink);\n  }\n\n  private newDataChannel_ = (link: DataLinkComponent)=>{\n    this.neighbourStore_.addLink(link);\n    this.emit(OnDataLinkUp, link.peerID(), link.options());\n    link.on(link.OnRecvData, (data)=>{\n      this.emit(OnRecvData, link.peerID(), data);\n    });\n\n    link.on(link.OnDataLinkDown, () =>{\n      this.emit(OnStopVideo, link.peerID());\n    });\n  };\n\n  private newMediaStream_ = (link: VideoLinkComponent, stream: MediaStream)=>{\n    this.neighbourStore_.addLink(link);\n    this.emit(OnStartVideo, link.peerID(), stream);\n    link.on(link.OnStopVideo, ()=>{\n      this.emit(OnStopVideo, link.peerID());\n    });\n  };\n\n  addDefaultStream(mediaStream: MediaStream){\n    this.linkGenerator_.setDefaultStream(mediaStream);\n  }\n\n  addVideoNeighbour(peerId: string, stream?: MediaStream | MediaStream[]){\n    var neighbour = new NeighbourRecord(peerId, NeighbourTypeEnum.video);\n    if(stream) neighbour.setStream(stream);\n    this.neighbourStore_.addRecord(neighbour);\n  }\n\n  addDataNeighbour(peerId: string, option?: PeerConnectOption){\n    var neighbour = new NeighbourRecord(peerId, NeighbourTypeEnum.data);\n    if(option) neighbour.setDataChannelOption(option);\n    this.neighbourStore_.addRecord(neighbour);\n  }\n\n  removeVideoNeighbour(peerId: string){\n    this.neighbourStore_.removeRecord(new NeighbourRecord(peerId, NeighbourTypeEnum.video));\n  }\n\n  removeDataNeighbour(peerId: string){\n    this.neighbourStore_.removeRecord(new NeighbourRecord(peerId, NeighbourTypeEnum.data));\n  }\n\n  //================= setup ==================\n\n  //================= data channel ===========\n  send(peerId: string, message: string){\n    var target = this.neighbourStore_.findLink(peerId + \"-data\");\n    if(target) target.send(message);\n  }\n\n  broadcast(message: string){\n    var neighbours = this.neighbourStore_.links();\n    _.each(neighbours, (link)=>{\n      link.send(message);\n    });\n  }\n  //================= data channel ===========\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/peer.io.ts\n **/","import * as Record from './neighbour_record';\nimport {NeighbourTypeEnum} from './peer.io';\nexport type Link = PeerJs.DataConnection | PeerJs.MediaConnection;\n\nexport class Util {\n  static waitTime(min:number, max:number):number {\n    return min + Math.random() * (max - min);\n  }\n\n  static key(peerID: string, type: NeighbourTypeEnum){\n    switch(type){\n      case NeighbourTypeEnum.video:\n      return peerID + \"-video\";\n      case NeighbourTypeEnum.data:\n      return peerID + \"-data\";\n    }\n  }\n\n  static isDataChannel(link: Link): link is PeerJs.DataConnection{\n    return link && link.hasOwnProperty('reliable');\n  }\n\n  static isMediaConnection(link: Link): link is PeerJs.MediaConnection{\n    return link && link.hasOwnProperty('localStream');\n  }\n\n  static isMediaStream(stream: any): stream is MediaStream{\n    return stream && ('active' in stream) && ('id' in stream);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Util.ts\n **/","// オフライン Peer確立なし 接続要求もなし\n// 初期状態\n\n/// <reference path=\"../../typings/tsd.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OnlineState from './online_state';\nimport ConnectedState from './connected_state';\n\nexport default class OfflineState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.initial };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(isOnline) state.setStateObject(new OnlineState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    //オフライン状態でpeerjsのステータスは変わらないので無視\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/offline_state.ts\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 6\n ** module chunks = 0\n **/","//NeighbourRecord is just a record.\n//It shows an Neighbour which LinkGenerator should establish a link to.\n//1. This object is created when user add an Neighbour.\n//2. This object is destroyed when user remove it.\n//3. This object has some delegated method.\n\n/// <reference path=\"../typings/tsd.d.ts\" />\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {Util} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\n\nexport type NeighbourHash = {[key: string]: NeighbourRecord};\nexport type NeighbourSource = ()=>NeighbourHash;\n\nexport class NeighbourRecord extends EventEmitter2{\n  private sources_: MediaStream[] = [];\n  private option_: PeerJs.PeerConnectOption = {\n    label: 'json',\n    serialization: 'none',\n    reliable: false\n  };\n\n  constructor(private peerId_: string, private type_: NeighbourTypeEnum){\n    super();\n    console.log(\"create neighbour record \" + peerId_ + \" type \" + type_);\n  }\n\n  type(){ return this.type_; }\n\n  peerID(): string{ return this.peerId_; }\n\n  streams(): MediaStream[]{\n    return this.sources_;\n  }\n\n  setStream(stream: MediaStream | MediaStream[]){\n    console.log('setstream');\n    if(stream instanceof Array){\n      console.log(\"array\");\n      console.log(stream[0].getVideoTracks());\n      Array.prototype.push.apply(this.sources_, stream);\n    } else if(Util.isMediaStream(stream)){\n      console.log(\"stream\");\n      console.log(stream.getVideoTracks());\n      this.sources_.push(stream);\n    }\n  }\n\n  dataChannelOption(): PeerJs.PeerConnectOption{\n    return this.option_;\n  }\n\n  setDataChannelOption(option: PeerJs.PeerConnectOption){\n    this.option_ = option;\n  }\n\n  //delegate\n  isEstablished: ()=>boolean = ()=>{\n    //throw(\"this method should be overwrite.\");\n    return false;\n  };\n\n  //delegate\n  addLink = (link: LinkComponentTemplate)=>{\n    throw(\"this method should be overwrite.\");\n  };\n\n  key(): string{\n    return Util.key(this.peerId_, this.type_);\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/neighbour_record.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/tsd.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OnlineState from './online_state';\nimport WaitClosingState from './wait_closing_state';\n\nexport default class ConnectedState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.connected };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(!isOnline) state.setStateObject(new WaitClosingState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(!isConnected) state.setStateObject(new OnlineState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/connected_state.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/tsd.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OfflineState from './offline_state';\nimport ConnectedState from './connected_state';\n\nexport default class OnlineState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.online };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(!isOnline) state.setStateObject(new OfflineState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(isConnected) state.setStateObject(new ConnectedState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/online_state.ts\n **/","//It is a component which wraps Link(MediaStream of DataChannel)\n//1. This object is created when Link is established.\n//2. This object is created only by LinkComponentFactory\n//3. When Link become down, this component is destroyed\n\n/// <reference path=\"../typings/tsd.d.ts\" />\nimport * as Record from './neighbour_record';\nimport {Util, Link} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\n\nexport interface PeerConnectOption{\n  label?: string;\n  metadata?: any;\n  serialization?: string;\n  reliable?: boolean;\n}\n\nexport class LinkComponentTemplate extends EventEmitter2 {\n  OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n  OnDataLinkDown = \"onDataLinkDown-in-link_component.ts\";\n  OnRecvData = \"onRecvData-in-link_component.ts\";\n\n  constructor(protected peerID_:string, protected link_: Link) {\n    super();\n  }\n\n  type(): NeighbourTypeEnum { return null; }\n\n  peerID(): string { return this.peerID_; };\n\n  key(): string { return Util.key(this.peerID_, this.type()); }\n\n  isEstablished(): boolean { return false; }\n\n  send(message:string): void { }\n\n  close(): void { }\n}\n\nexport class DataLinkComponent extends LinkComponentTemplate {\n  constructor(protected peerID_, protected link_: PeerJs.DataConnection){\n    super(peerID_, link_);\n\n    link_.on('close', ()=> {\n      this.link_ = null;\n      this.emit(this.OnDataLinkDown);\n    });\n\n    link_.on('error', (error)=> {\n      this.link_ = null;\n    });\n\n    link_.on('data', (data:string)=> {\n      this.emit(this.OnRecvData, data);\n    });\n  }\n\n  type() {\n    return NeighbourTypeEnum.data;\n  }\n\n  isEstablished():boolean {\n    if (!this.link_) return false;\n    if (!this.link_.open) return false;\n    return this.link_.open;\n  }\n\n  send(message:string) {\n    if (!this.isEstablished() || !this.link_) return;\n    this.link_.send(message);\n  }\n\n  close() {\n    if(this.link_) this.link_.close();\n    this.link_ = null;\n  }\n\n  options(): PeerConnectOption{\n    return {\n      metadata: this.link_.metadata,\n      serialization: this.link_.serialization,\n      reliable: this.link_.reliable\n    };\n  }\n}\n\nexport class VideoLinkComponent extends LinkComponentTemplate {\n  private _sources:Array<MediaStream> = [];\n\n  constructor(protected peerID_, protected link_: PeerJs.MediaConnection){\n    super(peerID_, link_);\n\n    link_.on('close', ()=> {\n      this.link_ = null;\n      this.emit(this.OnStopVideo);\n    });\n\n    link_.on('error', (error)=> {\n      this.link_ = null;\n    });\n  }\n\n  type() {\n    return NeighbourTypeEnum.video;\n  }\n\n  isEstablished(): boolean {\n    if (!this.link_) return false;\n    if (!this.link_.open) return false;\n    return this.link_.open;\n  }\n\n  sources() {\n    return this._sources;\n  }\n\n  setSource(source:MediaStream | Array<MediaStream>) {\n    if (source instanceof Array) Array.prototype.push.apply(this._sources, source);\n    else this._sources.push(<MediaStream>source);\n  }\n\n  close() {\n    if (this.link_) this.link_.close();\n    this.link_ = null;\n  }\n}\n\nexport class LinkComponentFactory {\n  static createLinkComponent(peerID:string, link: Link):LinkComponentTemplate {\n    if (Util.isDataChannel(link)) {\n      return new DataLinkComponent(peerID, link);\n    } else if (Util.isMediaConnection(link)) {\n      return new VideoLinkComponent(peerID, link);\n    }\n    return null;\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/link_component.ts\n **/","//LinkGenerator wraps PeerJs object and establish P2P Link\n//1. This object is created when PeerIo is initialized\n//2. This object is destroyed when PeerIo destroyed\n//3. This object may be unique, I'll make it singleton.A\n//4. This object has a State object that shows Online/Offline/PeerJsConnected status.\n//5. This object doesn't have any Neighbour's information.\n//    This object gets it through a delegate method in NeighbourSourceArray_\n//5. When client become online, it try to establish P2P link.\n//6. When Neighbour request this client to establish Link,\n//    this object create link object and hold it until 'onopen' event is fired.\n//7. When 'onopen' event is fired, it creates LinkComponent object and pass it to NeighbourStore object.\n//    NeighbourStore object may accept and decline this link.\n//    LinkGenerator doesn't care for it.\n//8. This object doesn't close Link. It only generates it.\n//9. This object has some streams to answer to requests from Neighbour.\n\n/// <reference path=\"../typings/tsd.d.ts\" />\nimport {NeighbourRecord, NeighbourSource} from './neighbour_record';\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {PeerJsStateManager, PeerJsStateEnum} from './states/peerjs_state';\nimport {Util} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport default class LinkGenerator extends EventEmitter2{\n  OnNewMediaStream = \"on-new-mediastream-in-link_generator.ts\";\n  OnNewDataChannel = \"on-new-datachannel-in-link_generator.ts\";\n  private state_: PeerJsStateManager;\n  private NeighbourSourceHash_: {[key: string]: NeighbourSource} = {};\n  private defaultStream_: MediaStream;\n\n  constructor(private peer_: PeerJs.Peer) {\n    super();\n\n    this.state_ = new PeerJsStateManager();\n    this.state_.onStateChanged(this.onStateChanged_);\n\n    this.checkNetworkStatus_();\n    this.wrapPeerEvent_();\n  }\n\n  setDefaultStream(stream: MediaStream){\n    this.defaultStream_ = stream;\n  }\n\n  addNeighbourSource(key: string, source: NeighbourSource){\n    this.NeighbourSourceHash_[key] = source;\n  }\n\n  removeNeighbourSource(key: string){\n    if(key in this.NeighbourSourceHash_) delete this.NeighbourSourceHash_[key];\n  }\n\n  //=============Network and PeerJs state methods start=========\n\n  private checkNetworkStatus_(){\n    (<any>Offline).options = { checks: { xhr: { url: 'https://skyway.io/dist/0.3/peer.min.js' } } };\n\n    Offline.on('up', ()=>{\n      this.state_.stateObject().network(this.state_, true);\n    });\n\n    Offline.on('down', ()=>{\n      this.state_.stateObject().network(this.state_, false);\n    });\n\n    if(Offline.state === 'up'){\n      this.state_.stateObject().network(this.state_, true);\n    }\n\n    Offline.check();\n  }\n\n  private onStateChanged_ = (state: PeerJsStateEnum)=>{\n    switch (state){\n      case PeerJsStateEnum.initial:\n      break;\n      case PeerJsStateEnum.online:\n      if(!this.peer_.disconnected) {\n        this.state_.stateObject().peer(this.state_, true);\n      }\n      break;\n      case PeerJsStateEnum.connected:\n      setTimeout(this._establishAllPeer, Util.waitTime(2000, 5000));\n      break;\n      case PeerJsStateEnum.wait_closing:\n      break;\n      default:\n      break;\n    }\n  };\n\n  private wrapPeerEvent_(){\n    this.peer_.on(\"open\", ()=>{\n      this.state_.stateObject().peer(this.state_, true);\n    });\n    this.peer_.on('error', (err)=>{ console.log(err); });\n    this.peer_.on('disconnected', ()=>{\n      this.state_.stateObject().peer(this.state_, false);\n    });\n    this.peer_.on('connection', this.onRecvConnect_);\n    this.peer_.on('call', this.onRecvCall_);\n  }\n\n  //=============peer event and change state end===========\n\n  //=============Link generation methods start===========\n\n  establishLink = (neighbour: NeighbourRecord)=>{\n    switch(neighbour.type()){\n      case NeighbourTypeEnum.video:\n      this.tryCall_(neighbour);\n      break;\n      case NeighbourTypeEnum.data:\n      this.tryConnect_(neighbour);\n      break;\n    }\n  };\n\n  private findNeighbour_(key: string): NeighbourRecord{\n    var source = _.find(this.NeighbourSourceHash_, (item: NeighbourSource)=>{\n      return key in item();\n    });\n    if(source) return source()[key];\n    return null;\n  }\n\n  private neighbourArray_(): Array<NeighbourRecord>{\n    return  _.reduce(this.NeighbourSourceHash_, (container: Array<NeighbourRecord>, val: NeighbourSource, key: string)=>{\n      return _.reduce(val(), (innerContainer: Array<NeighbourRecord>, record: NeighbourRecord, key: string)=>{\n        return innerContainer.concat(record);\n      }, container);\n    }, []);\n  }\n\n  private targetNeighbours_(): Array<NeighbourRecord>{\n    var neighbours = this.neighbourArray_();\n    return _.filter(neighbours, (neighbour: NeighbourRecord)=>{\n      return !neighbour.isEstablished();\n    });\n  }\n\n  private _establishAllPeer = ()=>{\n    _.each(this.targetNeighbours_(), this.establishLink);\n  };\n\n  private tryCall_(neighbour: NeighbourRecord){\n    var streams = neighbour.streams();\n    var retStream = this.defaultStream_;\n    if(streams && streams.length > 0) retStream = streams[0];\n    var mediaConnection = this.peer_.call(neighbour.peerID(), retStream);\n    if(!mediaConnection) return;\n    mediaConnection.on(\"stream\", (stream: MediaStream)=>{\n      var link = LinkComponentFactory.createLinkComponent(neighbour.peerID(), mediaConnection);\n      this.emit(this.OnNewMediaStream, link, stream);\n    });\n  }\n\n  private onRecvCall_ = (mediaConnection: PeerJs.MediaConnection)=> {\n    var neighbourID = mediaConnection.peer;\n    var neighbour = this.findNeighbour_(Util.key(neighbourID, NeighbourTypeEnum.video));\n    var retStream = this.defaultStream_;\n    if(neighbour){\n      var streams = neighbour.streams();\n      if(streams && streams.length > 0) {\n        retStream = streams[0];\n      }\n    }\n    mediaConnection.answer(retStream);\n    mediaConnection.on(\"stream\", (stream: MediaStream)=>{\n      var link = LinkComponentFactory.createLinkComponent(neighbourID, mediaConnection);\n      this.emit(this.OnNewMediaStream, link, stream);\n    });\n  };\n\n  private tryConnect_(neighbour: NeighbourRecord){\n    var dataConnection = this.peer_.connect(neighbour.peerID(), neighbour.dataChannelOption());\n    if(!dataConnection) return;\n    dataConnection.on('open', ()=>{\n      var link = LinkComponentFactory.createLinkComponent(neighbour.peerID(), dataConnection);\n      this.emit(this.OnNewDataChannel, link);\n    });\n  }\n\n  private onRecvConnect_ = (dataConnection: PeerJs.DataConnection)=> {\n    var neighbourID = dataConnection.peer;\n    dataConnection.on('open', ()=>{\n      var link = LinkComponentFactory.createLinkComponent(neighbourID, dataConnection);\n      this.emit(this.OnNewDataChannel, link);\n    });\n  };\n  //=============Link generation methods end===========\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/link_generator.ts\n **/","//NeighbourStore has records and links\n//1. This object is created when PeerIo is initialized\n//2. This object is destroyed when PeerIo destroyed\n//3. This object may be unique, I'll make it singleton.\n\n/// <reference path=\"../typings/tsd.d.ts\" />\nimport {NeighbourTypeEnum} from './peer.io';\nimport {NeighbourRecord, NeighbourSource, NeighbourHash} from './neighbour_record';\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport default class NeighbourStore extends EventEmitter2{\n  NEED_ESTABLISH_LINK = \"need-establish-link-in-neighbourstore\";\n  private recordsHash_: NeighbourHash = {};\n  private linksHash_: {[key: string]: LinkComponentTemplate} = {};\n\n  constructor(){\n    super();\n  }\n\n  private addRecord_(record: NeighbourRecord){\n    record.isEstablished = this.isEstablished_.bind(this, record.key());\n    record.addLink = this.addLink_.bind(this, record.key());\n    this.recordsHash_[record.key()] = record;\n  }\n\n  addRecord(record: NeighbourRecord){\n    if(record.key() in this.recordsHash_) {\n      if(this.recordsHash_[record.key()].isEstablished()){\n        // already connected to the peer\n        // ignore addrecord in this case\n      } else{\n        this.emit(this.NEED_ESTABLISH_LINK, this.recordsHash_[record.key()]);\n      }\n    } else{\n      this.addRecord_(record);\n      this.emit(this.NEED_ESTABLISH_LINK, record);\n    }\n  }\n\n  removeRecord(record: NeighbourRecord){\n    if(record.key() in this.linksHash_){\n      this.linksHash_[record.key()].close();\n      delete this.linksHash_[record.key()];\n    }\n\n    if(record.key() in this.recordsHash_){\n      delete this.recordsHash_[record.key()];\n    }\n  }\n\n  addLink(link: LinkComponentTemplate){\n    if(!(link.key() in this.recordsHash_)){\n      var record = new NeighbourRecord(link.peerID(), link.type());\n      this.addRecord_(record);\n    }\n    this.linksHash_[link.key()] = link;\n  }\n\n  findLink(key: string): LinkComponentTemplate{\n    return this.linksHash_[key];\n  }\n\n  links(): Array<LinkComponentTemplate>{\n    return _.reduce(this.linksHash_, (innerContainer: Array<LinkComponentTemplate>, record: LinkComponentTemplate, key: string)=>{\n      return innerContainer.concat(record);\n    }, []);\n  }\n\n  neighbours:()=>NeighbourHash = ()=>{\n    return this.recordsHash_;\n  };\n\n  private addLink_(key: string, link: LinkComponentTemplate){\n    if(this.isEstablished_(key)) this.linksHash_[key].close();\n    this.linksHash_[key] = link;\n  }\n\n  private isEstablished_(key: string): boolean{\n    if(!(key in this.linksHash_)) return false;\n    return this.linksHash_[key].isEstablished();\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/neighbour_store.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/tsd.d.ts\" />\n/// <reference path=\"./peerjs_state.ts\" />\n/// <reference path=\"./offline_state.ts\" />\n/// <reference path=\"./connected_state.ts\" />\n\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OfflineState from './offline_state';\nimport ConnectedState from './connected_state';\n\nexport default class WaitClosingState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.wait_closing };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(isOnline) state.setStateObject(new ConnectedState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(!isConnected) state.setStateObject(new OfflineState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/wait_closing_state.ts\n **/","/*! offline-js 0.7.14 */\n(function(){var a,b,c,d,e,f,g;d=function(a,b){var c,d,e,f;e=[];for(d in b.prototype)try{f=b.prototype[d],null==a[d]&&\"function\"!=typeof f?e.push(a[d]=f):e.push(void 0)}catch(g){c=g}return e},a={},a.options=window.Offline?window.Offline.options||{}:{},c={checks:{xhr:{url:function(){return\"/favicon.ico?_=\"+(new Date).getTime()},timeout:5e3,type:\"HEAD\"},image:{url:function(){return\"/favicon.ico?_=\"+(new Date).getTime()}},active:\"xhr\"},checkOnLoad:!1,interceptRequests:!0,reconnect:!0,deDupBody:!1},e=function(a,b){var c,d,e,f,g,h;for(c=a,h=b.split(\".\"),d=e=0,f=h.length;f>e&&(g=h[d],c=c[g],\"object\"==typeof c);d=++e);return d===h.length-1?c:void 0},a.getOption=function(b){var d,f;return f=null!=(d=e(a.options,b))?d:e(c,b),\"function\"==typeof f?f():f},\"function\"==typeof window.addEventListener&&window.addEventListener(\"online\",function(){return setTimeout(a.confirmUp,100)},!1),\"function\"==typeof window.addEventListener&&window.addEventListener(\"offline\",function(){return a.confirmDown()},!1),a.state=\"up\",a.markUp=function(){return a.trigger(\"confirmed-up\"),\"up\"!==a.state?(a.state=\"up\",a.trigger(\"up\")):void 0},a.markDown=function(){return a.trigger(\"confirmed-down\"),\"down\"!==a.state?(a.state=\"down\",a.trigger(\"down\")):void 0},f={},a.on=function(b,c,d){var e,g,h,i,j;if(g=b.split(\" \"),g.length>1){for(j=[],h=0,i=g.length;i>h;h++)e=g[h],j.push(a.on(e,c,d));return j}return null==f[b]&&(f[b]=[]),f[b].push([d,c])},a.off=function(a,b){var c,d,e,g,h;if(null!=f[a]){if(b){for(e=0,h=[];e<f[a].length;)g=f[a][e],d=g[0],c=g[1],c===b?h.push(f[a].splice(e,1)):h.push(e++);return h}return f[a]=[]}},a.trigger=function(a){var b,c,d,e,g,h,i;if(null!=f[a]){for(g=f[a],i=[],d=0,e=g.length;e>d;d++)h=g[d],b=h[0],c=h[1],i.push(c.call(b));return i}},b=function(a,b,c){var d,e,f,g,h;return h=function(){return a.status&&a.status<12e3?b():c()},null===a.onprogress?(d=a.onerror,a.onerror=function(){return c(),\"function\"==typeof d?d.apply(null,arguments):void 0},g=a.ontimeout,a.ontimeout=function(){return c(),\"function\"==typeof g?g.apply(null,arguments):void 0},e=a.onload,a.onload=function(){return h(),\"function\"==typeof e?e.apply(null,arguments):void 0}):(f=a.onreadystatechange,a.onreadystatechange=function(){return 4===a.readyState?h():0===a.readyState&&c(),\"function\"==typeof f?f.apply(null,arguments):void 0})},a.checks={},a.checks.xhr=function(){var c,d;d=new XMLHttpRequest,d.offline=!1,d.open(a.getOption(\"checks.xhr.type\"),a.getOption(\"checks.xhr.url\"),!0),null!=d.timeout&&(d.timeout=a.getOption(\"checks.xhr.timeout\")),b(d,a.markUp,a.markDown);try{d.send()}catch(e){c=e,a.markDown()}return d},a.checks.image=function(){var b;return b=document.createElement(\"img\"),b.onerror=a.markDown,b.onload=a.markUp,void(b.src=a.getOption(\"checks.image.url\"))},a.checks.down=a.markDown,a.checks.up=a.markUp,a.check=function(){return a.trigger(\"checking\"),a.checks[a.getOption(\"checks.active\")]()},a.confirmUp=a.confirmDown=a.check,a.onXHR=function(a){var b,c,e;return e=function(b,c){var d;return d=b.open,b.open=function(e,f,g,h,i){return a({type:e,url:f,async:g,flags:c,user:h,password:i,xhr:b}),d.apply(b,arguments)}},c=window.XMLHttpRequest,window.XMLHttpRequest=function(a){var b,d,f;return f=new c(a),e(f,a),d=f.setRequestHeader,f.headers={},f.setRequestHeader=function(a,b){return f.headers[a]=b,d.call(f,a,b)},b=f.overrideMimeType,f.overrideMimeType=function(a){return f.mimeType=a,b.call(f,a)},f},d(window.XMLHttpRequest,c),null!=window.XDomainRequest?(b=window.XDomainRequest,window.XDomainRequest=function(){var a;return a=new b,e(a),a},d(window.XDomainRequest,b)):void 0},g=function(){return a.getOption(\"interceptRequests\")&&a.onXHR(function(c){var d;return d=c.xhr,d.offline!==!1?b(d,a.markUp,a.confirmDown):void 0}),a.getOption(\"checkOnLoad\")?a.check():void 0},setTimeout(g,0),window.Offline=a}).call(this),function(){var a,b,c,d,e,f,g,h,i;if(!window.Offline)throw new Error(\"Offline Reconnect brought in without offline.js\");d=Offline.reconnect={},f=null,e=function(){var a;return null!=d.state&&\"inactive\"!==d.state&&Offline.trigger(\"reconnect:stopped\"),d.state=\"inactive\",d.remaining=d.delay=null!=(a=Offline.getOption(\"reconnect.initialDelay\"))?a:3},b=function(){var a,b;return a=null!=(b=Offline.getOption(\"reconnect.delay\"))?b:Math.min(Math.ceil(1.5*d.delay),3600),d.remaining=d.delay=a},g=function(){return\"connecting\"!==d.state?(d.remaining-=1,Offline.trigger(\"reconnect:tick\"),0===d.remaining?h():void 0):void 0},h=function(){return\"waiting\"===d.state?(Offline.trigger(\"reconnect:connecting\"),d.state=\"connecting\",Offline.check()):void 0},a=function(){return Offline.getOption(\"reconnect\")?(e(),d.state=\"waiting\",Offline.trigger(\"reconnect:started\"),f=setInterval(g,1e3)):void 0},i=function(){return null!=f&&clearInterval(f),e()},c=function(){return Offline.getOption(\"reconnect\")&&\"connecting\"===d.state?(Offline.trigger(\"reconnect:failure\"),d.state=\"waiting\",b()):void 0},d.tryNow=h,e(),Offline.on(\"down\",a),Offline.on(\"confirmed-down\",c),Offline.on(\"up\",i)}.call(this),function(){var a,b,c,d,e,f;if(!window.Offline)throw new Error(\"Requests module brought in without offline.js\");c=[],f=!1,d=function(a){return Offline.getOption(\"requests\")!==!1?(Offline.trigger(\"requests:capture\"),\"down\"!==Offline.state&&(f=!0),c.push(a)):void 0},e=function(a){var b,c,d,e,f,g,h,i,j;if(j=a.xhr,g=a.url,f=a.type,h=a.user,d=a.password,b=a.body,Offline.getOption(\"requests\")!==!1){j.abort(),j.open(f,g,!0,h,d),e=j.headers;for(c in e)i=e[c],j.setRequestHeader(c,i);return j.mimeType&&j.overrideMimeType(j.mimeType),j.send(b)}},a=function(){return c=[]},b=function(){var b,d,f,g,h,i,j;if(Offline.getOption(\"requests\")!==!1){for(Offline.trigger(\"requests:flush\"),i={},d=0,g=c.length;g>d;d++)h=c[d],j=h.url.replace(/(\\?|&)_=[0-9]+/,function(a,b){return\"?\"===b?b:\"\"}),Offline.getOption(\"deDupBody\")?(b=h.body,b=\"[object Object]\"===b.toString()?JSON.stringify(b):b.toString(),i[h.type.toUpperCase()+\" - \"+j+\" - \"+b]=h):i[h.type.toUpperCase()+\" - \"+j]=h;for(f in i)h=i[f],e(h);return a()}},setTimeout(function(){return Offline.getOption(\"requests\")!==!1?(Offline.on(\"confirmed-up\",function(){return f?(f=!1,a()):void 0}),Offline.on(\"up\",b),Offline.on(\"down\",function(){return f=!1}),Offline.onXHR(function(a){var b,c,e,f,g;return g=a.xhr,e=a.async,g.offline!==!1&&(f=function(){return d(a)},c=g.send,g.send=function(b){return a.body=b,c.apply(g,arguments)},e)?null===g.onprogress?(g.addEventListener(\"error\",f,!1),g.addEventListener(\"timeout\",f,!1)):(b=g.onreadystatechange,g.onreadystatechange=function(){return 0===g.readyState?f():4===g.readyState&&(0===g.status||g.status>=12e3)&&f(),\"function\"==typeof b?b.apply(null,arguments):void 0}):void 0}),Offline.requests={flush:b,clear:a}):void 0},0)}.call(this),function(){var a,b,c,d,e;if(!Offline)throw new Error(\"Offline simulate brought in without offline.js\");for(d=[\"up\",\"down\"],b=0,c=d.length;c>b;b++)e=d[b],(document.querySelector(\"script[data-simulate='\"+e+\"']\")||(\"undefined\"!=typeof localStorage&&null!==localStorage?localStorage.OFFLINE_SIMULATE:void 0)===e)&&(null==Offline.options&&(Offline.options={}),null==(a=Offline.options).checks&&(a.checks={}),Offline.options.checks.active=e)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!window.Offline)throw new Error(\"Offline UI brought in without offline.js\");b='<div class=\"offline-ui\"><div class=\"offline-ui-content\"></div></div>',a='<a href class=\"offline-ui-retry\"></a>',f=function(a){var b;return b=document.createElement(\"div\"),b.innerHTML=a,b.children[0]},g=e=null,d=function(a){return k(a),g.className+=\" \"+a},k=function(a){return g.className=g.className.replace(new RegExp(\"(^| )\"+a.split(\" \").join(\"|\")+\"( |$)\",\"gi\"),\" \")},i={},h=function(a,b){return d(a),null!=i[a]&&clearTimeout(i[a]),i[a]=setTimeout(function(){return k(a),delete i[a]},1e3*b)},m=function(a){var b,c,d,e;d={day:86400,hour:3600,minute:60,second:1};for(c in d)if(b=d[c],a>=b)return e=Math.floor(a/b),[e,c];return[\"now\",\"\"]},l=function(){var c,h;return g=f(b),document.body.appendChild(g),null!=Offline.reconnect&&Offline.getOption(\"reconnect\")&&(g.appendChild(f(a)),c=g.querySelector(\".offline-ui-retry\"),h=function(a){return a.preventDefault(),Offline.reconnect.tryNow()},null!=c.addEventListener?c.addEventListener(\"click\",h,!1):c.attachEvent(\"click\",h)),d(\"offline-ui-\"+Offline.state),e=g.querySelector(\".offline-ui-content\")},j=function(){return l(),Offline.on(\"up\",function(){return k(\"offline-ui-down\"),d(\"offline-ui-up\"),h(\"offline-ui-up-2s\",2),h(\"offline-ui-up-5s\",5)}),Offline.on(\"down\",function(){return k(\"offline-ui-up\"),d(\"offline-ui-down\"),h(\"offline-ui-down-2s\",2),h(\"offline-ui-down-5s\",5)}),Offline.on(\"reconnect:connecting\",function(){return d(\"offline-ui-connecting\"),k(\"offline-ui-waiting\")}),Offline.on(\"reconnect:tick\",function(){var a,b,c;return d(\"offline-ui-waiting\"),k(\"offline-ui-connecting\"),a=m(Offline.reconnect.remaining),b=a[0],c=a[1],e.setAttribute(\"data-retry-in-value\",b),e.setAttribute(\"data-retry-in-unit\",c)}),Offline.on(\"reconnect:stopped\",function(){return k(\"offline-ui-connecting offline-ui-waiting\"),e.setAttribute(\"data-retry-in-value\",null),e.setAttribute(\"data-retry-in-unit\",null)}),Offline.on(\"reconnect:failure\",function(){return h(\"offline-ui-reconnect-failed-2s\",2),h(\"offline-ui-reconnect-failed-5s\",5)}),Offline.on(\"reconnect:success\",function(){return h(\"offline-ui-reconnect-succeeded-2s\",2),h(\"offline-ui-reconnect-succeeded-5s\",5)})},\"complete\"===document.readyState?j():null!=document.addEventListener?document.addEventListener(\"DOMContentLoaded\",j,!1):(c=document.onreadystatechange,document.onreadystatechange=function(){return\"complete\"===document.readyState&&j(),\"function\"==typeof c?c.apply(null,arguments):void 0})}.call(this);\n\n\n/** WEBPACK FOOTER **\n ** ./bower_components/offline/offline.min.js\n **/"],"sourceRoot":""}