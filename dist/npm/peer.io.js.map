{"version":3,"sources":["webpack:///peer.io.js","webpack:///webpack/bootstrap b71b58a08c01d7386f01","webpack:///external \"eventemitter2\"","webpack:///./src/states/peerjs_state.ts","webpack:///./src/peer.io.ts","webpack:///./src/Util.ts","webpack:///./src/states/offline_state.ts","webpack:///external \"lodash\"","webpack:///./src/link_component.ts","webpack:///./src/neighbour_record.ts","webpack:///./src/states/connected_state.ts","webpack:///./src/states/online_state.ts","webpack:///./src/link_generator.ts","webpack:///./src/neighbour_store.ts","webpack:///./src/states/wait_closing_state.ts","webpack:///./bower_components/offline/offline.min.js"],"names":["exports","modules","__webpack_require__","moduleId","installedModules","module","id","loaded","call","m","c","p","require","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","_createClass","defineProperties","target","props","i","length","descriptor","defineProperty","key","protoProps","staticProps","offline_state_1","eventemitter2_1","PeerJsStateEnum","PeerJsStateManager","_eventemitter2_1$Even","this","_this","getPrototypeOf","_ON_STATE_CHANGED","_state","state","emit","callback","on","EventEmitter2","neighbour_record_1","neighbour_store_1","link_component_1","link_generator_1","_","NeighbourTypeEnum","OnStartVideo","OnStopVideo","OnDataLinkUp","OnDataLinkDown","OnRecvData","PeerIo","peerJs_","newDataChannel_","link","neighbourStore_","addLink","peerID","options","LinkComponentTemplate","data","newMediaStream_","stream","linkGenerator_","addNeighbourSource","neighbours","OnNewDataChannel","OnNewMediaStream","OnNeedEstablishLink","establishLink","mediaStream","setDefaultStream","peerId","neighbour","NeighbourRecord","video","setStream","addRecord","option","setDataChannelOption","removeRecord","message","findLink","send","links","each","peer_io_1","Util","min","max","Math","random","type","hasOwnProperty","peerjs_state_1","online_state_1","OfflineState","initial","isOnline","setStateObject","isConnected","Util_1","peerID_","link_","DataLinkComponent","_LinkComponentTemplat","_this2","error","open","isEstablished","close","metadata","serialization","reliable","VideoLinkComponent","_LinkComponentTemplat2","_this3","_sources","source","Array","push","apply","LinkComponentFactory","isDataChannel","isMediaConnection","peerId_","type_","sources_","option_","label","console","log","getVideoTracks","isMediaStream","wait_closing_state_1","ConnectedState","connected","connected_state_1","OnlineState","online","LinkGenerator","peer_","NeighbourSourceHash_","onStateChanged_","disconnected","state_","stateObject","peer","setTimeout","_establishAllPeer","waitTime","wait_closing","tryCall_","tryConnect_","targetNeighbours_","onRecvCall_","mediaConnection","neighbourID","findNeighbour_","retStream","defaultStream_","streams","answer","createLinkComponent","onRecvConnect_","dataConnection","onStateChanged","checkNetworkStatus_","wrapPeerEvent_","Offline","checks","xhr","url","network","check","err","find","item","reduce","container","val","innerContainer","record","concat","neighbourArray_","filter","_this4","_this5","connect","dataChannelOption","NeighbourStore","_Object$getPrototypeO","_len","arguments","args","_key","recordsHash_","linksHash_","isEstablished_","bind","addLink_","addRecord_","WaitClosingState","_typeof","Symbol","iterator","obj","a","b","d","e","f","g","window","Date","getTime","timeout","image","active","checkOnLoad","interceptRequests","reconnect","deDupBody","h","split","getOption","addEventListener","confirmUp","confirmDown","markUp","trigger","markDown","j","off","splice","_b","status","onprogress","onerror","ontimeout","onload","onreadystatechange","readyState","XMLHttpRequest","offline","document","createElement","src","down","up","onXHR","async","flags","user","password","setRequestHeader","headers","overrideMimeType","mimeType","XDomainRequest","undefined","Error","remaining","delay","ceil","setInterval","clearInterval","tryNow","body","abort","replace","toString","JSON","stringify","toUpperCase","requests","flush","clear","querySelector","localStorage","OFFLINE_SIMULATE","k","l","innerHTML","children","className","RegExp","join","clearTimeout","day","hour","minute","second","floor","appendChild","preventDefault","attachEvent","setAttribute"],"mappings":"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","file":"peer.io.js","sourcesContent":["exports[\"PeerIo\"] =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"dist/npm\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(14);\n\tmodule.exports = __webpack_require__(3);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"eventemitter2\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// NetworkのOn/Off, PeerJsのcon/disconnect, neighbourへの接続要求を管理するstate\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/main.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t(function (PeerJsStateEnum) {\n\t    PeerJsStateEnum[PeerJsStateEnum[\"initial\"] = 1] = \"initial\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"online\"] = 2] = \"online\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"connected\"] = 3] = \"connected\";\n\t    PeerJsStateEnum[PeerJsStateEnum[\"wait_closing\"] = 4] = \"wait_closing\";\n\t})(exports.PeerJsStateEnum || (exports.PeerJsStateEnum = {}));\n\tvar PeerJsStateEnum = exports.PeerJsStateEnum;\n\t\n\tvar PeerJsStateManager = function (_eventemitter2_1$Even) {\n\t    _inherits(PeerJsStateManager, _eventemitter2_1$Even);\n\t\n\t    function PeerJsStateManager() {\n\t        _classCallCheck(this, PeerJsStateManager);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(PeerJsStateManager).call(this));\n\t\n\t        _this._ON_STATE_CHANGED = \"onStateCahnged\";\n\t        _this._state = new offline_state_1.default();\n\t        return _this;\n\t    }\n\t\n\t    _createClass(PeerJsStateManager, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return this._state.state();\n\t        }\n\t    }, {\n\t        key: 'stateObject',\n\t        value: function stateObject() {\n\t            return this._state;\n\t        }\n\t    }, {\n\t        key: 'setStateObject',\n\t        value: function setStateObject(state) {\n\t            this._state = state;\n\t            this.emit(this._ON_STATE_CHANGED, state.state());\n\t        }\n\t    }, {\n\t        key: 'onStateChanged',\n\t        value: function onStateChanged(callback) {\n\t            this.on(this._ON_STATE_CHANGED, callback);\n\t        }\n\t    }]);\n\t\n\t    return PeerJsStateManager;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.PeerJsStateManager = PeerJsStateManager;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// Main Controller\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar neighbour_record_1 = __webpack_require__(8);\n\tvar neighbour_store_1 = __webpack_require__(12);\n\tvar link_component_1 = __webpack_require__(7);\n\tvar link_generator_1 = __webpack_require__(11);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t(function (NeighbourTypeEnum) {\n\t    NeighbourTypeEnum[NeighbourTypeEnum[\"video\"] = 1] = \"video\";\n\t    NeighbourTypeEnum[NeighbourTypeEnum[\"data\"] = 2] = \"data\";\n\t})(exports.NeighbourTypeEnum || (exports.NeighbourTypeEnum = {}));\n\tvar NeighbourTypeEnum = exports.NeighbourTypeEnum;\n\texports.OnStartVideo = \"onStartVideo-in-peer.io.ts\";\n\texports.OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n\texports.OnDataLinkUp = \"onDataLinkUp\";\n\texports.OnDataLinkDown = \"onDataLinkDown\";\n\texports.OnRecvData = \"onRecvData\";\n\t\n\tvar PeerIo = function (_eventemitter2_1$Even) {\n\t    _inherits(PeerIo, _eventemitter2_1$Even);\n\t\n\t    //================= setup ==================\n\t\n\t    function PeerIo(peerJs_) {\n\t        _classCallCheck(this, PeerIo);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(PeerIo).call(this));\n\t\n\t        _this.peerJs_ = peerJs_;\n\t        _this.newDataChannel_ = function (link) {\n\t            _this.neighbourStore_.addLink(link);\n\t            _this.emit(exports.OnDataLinkUp, link.peerID(), link.options());\n\t            link.on(link_component_1.LinkComponentTemplate.OnRecvData, function (data) {\n\t                _this.emit(exports.OnRecvData, link.peerID(), data);\n\t            });\n\t            link.on(link_component_1.LinkComponentTemplate.OnDataLinkDown, function () {\n\t                _this.emit(exports.OnStopVideo, link.peerID());\n\t            });\n\t        };\n\t        _this.newMediaStream_ = function (link, stream) {\n\t            _this.neighbourStore_.addLink(link);\n\t            _this.emit(exports.OnStartVideo, link.peerID(), stream);\n\t            link.on(link_component_1.LinkComponentTemplate.OnStopVideo, function () {\n\t                _this.emit(exports.OnStopVideo, link.peerID());\n\t            });\n\t        };\n\t        _this.neighbourStore_ = new neighbour_store_1.default();\n\t        _this.linkGenerator_ = new link_generator_1.default(peerJs_);\n\t        _this.linkGenerator_.addNeighbourSource(\"neighbourSource\", _this.neighbourStore_.neighbours);\n\t        _this.linkGenerator_.on(link_generator_1.default.OnNewDataChannel, _this.newDataChannel_);\n\t        _this.linkGenerator_.on(link_generator_1.default.OnNewMediaStream, _this.newMediaStream_);\n\t        _this.neighbourStore_.on(neighbour_store_1.default.OnNeedEstablishLink, _this.linkGenerator_.establishLink);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(PeerIo, [{\n\t        key: 'addDefaultStream',\n\t        value: function addDefaultStream(mediaStream) {\n\t            this.linkGenerator_.setDefaultStream(mediaStream);\n\t        }\n\t    }, {\n\t        key: 'addVideoNeighbour',\n\t        value: function addVideoNeighbour(peerId, stream) {\n\t            var neighbour = new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.video);\n\t            if (stream) neighbour.setStream(stream);\n\t            this.neighbourStore_.addRecord(neighbour);\n\t        }\n\t    }, {\n\t        key: 'addDataNeighbour',\n\t        value: function addDataNeighbour(peerId, option) {\n\t            var neighbour = new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.data);\n\t            if (option) neighbour.setDataChannelOption(option);\n\t            this.neighbourStore_.addRecord(neighbour);\n\t        }\n\t    }, {\n\t        key: 'removeVideoNeighbour',\n\t        value: function removeVideoNeighbour(peerId) {\n\t            this.neighbourStore_.removeRecord(new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.video));\n\t        }\n\t    }, {\n\t        key: 'removeDataNeighbour',\n\t        value: function removeDataNeighbour(peerId) {\n\t            this.neighbourStore_.removeRecord(new neighbour_record_1.NeighbourRecord(peerId, NeighbourTypeEnum.data));\n\t        }\n\t        //================= setup ==================\n\t        //================= data channel ===========\n\t\n\t    }, {\n\t        key: 'send',\n\t        value: function send(peerId, message) {\n\t            var target = this.neighbourStore_.findLink(peerId + \"-data\");\n\t            if (target) target.send(message);\n\t        }\n\t    }, {\n\t        key: 'broadcast',\n\t        value: function broadcast(message) {\n\t            var neighbours = this.neighbourStore_.links();\n\t            _.each(neighbours, function (link) {\n\t                link.send(message);\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return PeerIo;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.PeerIo = PeerIo;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peer_io_1 = __webpack_require__(3);\n\t\n\tvar Util = function () {\n\t    function Util() {\n\t        _classCallCheck(this, Util);\n\t    }\n\t\n\t    _createClass(Util, null, [{\n\t        key: \"waitTime\",\n\t        value: function waitTime(min, max) {\n\t            return min + Math.random() * (max - min);\n\t        }\n\t    }, {\n\t        key: \"key\",\n\t        value: function key(peerID, type) {\n\t            switch (type) {\n\t                case peer_io_1.NeighbourTypeEnum.video:\n\t                    return peerID + \"-video\";\n\t                case peer_io_1.NeighbourTypeEnum.data:\n\t                    return peerID + \"-data\";\n\t            }\n\t        }\n\t    }, {\n\t        key: \"isDataChannel\",\n\t        value: function isDataChannel(link) {\n\t            return link && link.hasOwnProperty('reliable');\n\t        }\n\t    }, {\n\t        key: \"isMediaConnection\",\n\t        value: function isMediaConnection(link) {\n\t            return link && link.hasOwnProperty('localStream');\n\t        }\n\t    }, {\n\t        key: \"isMediaStream\",\n\t        value: function isMediaStream(stream) {\n\t            return stream && 'active' in stream && 'id' in stream;\n\t        }\n\t    }]);\n\t\n\t    return Util;\n\t}();\n\t\n\texports.Util = Util;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オフライン Peer確立なし 接続要求もなし\n\t// 初期状態\n\t\"use strict\";\n\t/// <reference path=\"../../typings/main.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar online_state_1 = __webpack_require__(10);\n\t\n\tvar OfflineState = function () {\n\t    function OfflineState() {\n\t        _classCallCheck(this, OfflineState);\n\t    }\n\t\n\t    _createClass(OfflineState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.initial;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (isOnline) state.setStateObject(new online_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            //オフライン状態でpeerjsのステータスは変わらないので無視\n\t        }\n\t    }]);\n\t\n\t    return OfflineState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = OfflineState;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"lodash\");\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//It is a component which wraps Link(MediaStream of DataChannel)\n\t//1. This object is created when Link is established.\n\t//2. This object is created only by LinkComponentFactory\n\t//3. When Link become down, this component is destroyed\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Util_1 = __webpack_require__(4);\n\tvar peer_io_1 = __webpack_require__(3);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t\n\tvar LinkComponentTemplate = function (_eventemitter2_1$Even) {\n\t    _inherits(LinkComponentTemplate, _eventemitter2_1$Even);\n\t\n\t    function LinkComponentTemplate(peerID_, link_) {\n\t        _classCallCheck(this, LinkComponentTemplate);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(LinkComponentTemplate).call(this));\n\t\n\t        _this.peerID_ = peerID_;\n\t        _this.link_ = link_;\n\t        return _this;\n\t    }\n\t\n\t    _createClass(LinkComponentTemplate, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return null;\n\t        }\n\t    }, {\n\t        key: 'peerID',\n\t        value: function peerID() {\n\t            return this.peerID_;\n\t        }\n\t    }, {\n\t        key: 'key',\n\t        value: function key() {\n\t            return Util_1.Util.key(this.peerID_, this.type());\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            return false;\n\t        }\n\t    }, {\n\t        key: 'send',\n\t        value: function send(message) {}\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {}\n\t    }]);\n\t\n\t    return LinkComponentTemplate;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\tLinkComponentTemplate.OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n\tLinkComponentTemplate.OnDataLinkDown = \"onDataLinkDown-in-link_component.ts\";\n\tLinkComponentTemplate.OnRecvData = \"onRecvData-in-link_component.ts\";\n\texports.LinkComponentTemplate = LinkComponentTemplate;\n\t\n\tvar DataLinkComponent = function (_LinkComponentTemplat) {\n\t    _inherits(DataLinkComponent, _LinkComponentTemplat);\n\t\n\t    function DataLinkComponent(peerID_, link_) {\n\t        _classCallCheck(this, DataLinkComponent);\n\t\n\t        var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(DataLinkComponent).call(this, peerID_, link_));\n\t\n\t        _this2.peerID_ = peerID_;\n\t        _this2.link_ = link_;\n\t        link_.on('close', function () {\n\t            _this2.link_ = null;\n\t            _this2.emit(LinkComponentTemplate.OnDataLinkDown);\n\t        });\n\t        link_.on('error', function (error) {\n\t            _this2.link_ = null;\n\t        });\n\t        link_.on('data', function (data) {\n\t            _this2.emit(LinkComponentTemplate.OnRecvData, data);\n\t        });\n\t        return _this2;\n\t    }\n\t\n\t    _createClass(DataLinkComponent, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return peer_io_1.NeighbourTypeEnum.data;\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            if (!this.link_) return false;\n\t            if (!this.link_.open) return false;\n\t            return this.link_.open;\n\t        }\n\t    }, {\n\t        key: 'send',\n\t        value: function send(message) {\n\t            if (!this.isEstablished() || !this.link_) return;\n\t            this.link_.send(message);\n\t        }\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {\n\t            if (this.link_) this.link_.close();\n\t            this.link_ = null;\n\t        }\n\t    }, {\n\t        key: 'options',\n\t        value: function options() {\n\t            return {\n\t                metadata: this.link_.metadata,\n\t                serialization: this.link_.serialization,\n\t                reliable: this.link_.reliable\n\t            };\n\t        }\n\t    }]);\n\t\n\t    return DataLinkComponent;\n\t}(LinkComponentTemplate);\n\t\n\texports.DataLinkComponent = DataLinkComponent;\n\t\n\tvar VideoLinkComponent = function (_LinkComponentTemplat2) {\n\t    _inherits(VideoLinkComponent, _LinkComponentTemplat2);\n\t\n\t    function VideoLinkComponent(peerID_, link_) {\n\t        _classCallCheck(this, VideoLinkComponent);\n\t\n\t        var _this3 = _possibleConstructorReturn(this, Object.getPrototypeOf(VideoLinkComponent).call(this, peerID_, link_));\n\t\n\t        _this3.peerID_ = peerID_;\n\t        _this3.link_ = link_;\n\t        _this3._sources = [];\n\t        link_.on('close', function () {\n\t            _this3.link_ = null;\n\t            _this3.emit(LinkComponentTemplate.OnStopVideo);\n\t        });\n\t        link_.on('error', function (error) {\n\t            _this3.link_ = null;\n\t        });\n\t        return _this3;\n\t    }\n\t\n\t    _createClass(VideoLinkComponent, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return peer_io_1.NeighbourTypeEnum.video;\n\t        }\n\t    }, {\n\t        key: 'isEstablished',\n\t        value: function isEstablished() {\n\t            if (!this.link_) return false;\n\t            if (!this.link_.open) return false;\n\t            return this.link_.open;\n\t        }\n\t    }, {\n\t        key: 'sources',\n\t        value: function sources() {\n\t            return this._sources;\n\t        }\n\t    }, {\n\t        key: 'setSource',\n\t        value: function setSource(source) {\n\t            if (source instanceof Array) Array.prototype.push.apply(this._sources, source);else this._sources.push(source);\n\t        }\n\t    }, {\n\t        key: 'close',\n\t        value: function close() {\n\t            if (this.link_) this.link_.close();\n\t            this.link_ = null;\n\t        }\n\t    }]);\n\t\n\t    return VideoLinkComponent;\n\t}(LinkComponentTemplate);\n\t\n\texports.VideoLinkComponent = VideoLinkComponent;\n\t\n\tvar LinkComponentFactory = function () {\n\t    function LinkComponentFactory() {\n\t        _classCallCheck(this, LinkComponentFactory);\n\t    }\n\t\n\t    _createClass(LinkComponentFactory, null, [{\n\t        key: 'createLinkComponent',\n\t        value: function createLinkComponent(peerID, link) {\n\t            if (Util_1.Util.isDataChannel(link)) {\n\t                return new DataLinkComponent(peerID, link);\n\t            } else if (Util_1.Util.isMediaConnection(link)) {\n\t                return new VideoLinkComponent(peerID, link);\n\t            }\n\t            return null;\n\t        }\n\t    }]);\n\t\n\t    return LinkComponentFactory;\n\t}();\n\t\n\texports.LinkComponentFactory = LinkComponentFactory;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//NeighbourRecord is just a record.\n\t//It shows an Neighbour which LinkGenerator should establish a link to.\n\t//1. This object is created when user add an Neighbour.\n\t//2. This object is destroyed when user remove it.\n\t//3. This object has some delegated method.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Util_1 = __webpack_require__(4);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\t\n\tvar NeighbourRecord = function (_eventemitter2_1$Even) {\n\t    _inherits(NeighbourRecord, _eventemitter2_1$Even);\n\t\n\t    function NeighbourRecord(peerId_, type_) {\n\t        _classCallCheck(this, NeighbourRecord);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(NeighbourRecord).call(this));\n\t\n\t        _this.peerId_ = peerId_;\n\t        _this.type_ = type_;\n\t        _this.sources_ = [];\n\t        _this.option_ = {\n\t            label: 'json',\n\t            serialization: 'none',\n\t            reliable: false\n\t        };\n\t        //delegate\n\t        _this.isEstablished = function () {\n\t            //throw(\"this method should be overwrite.\");\n\t            return false;\n\t        };\n\t        //delegate\n\t        _this.addLink = function (link) {\n\t            throw \"this method should be overwrite.\";\n\t        };\n\t        console.log(\"create neighbour record \" + peerId_ + \" type \" + type_);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(NeighbourRecord, [{\n\t        key: 'type',\n\t        value: function type() {\n\t            return this.type_;\n\t        }\n\t    }, {\n\t        key: 'peerID',\n\t        value: function peerID() {\n\t            return this.peerId_;\n\t        }\n\t    }, {\n\t        key: 'streams',\n\t        value: function streams() {\n\t            return this.sources_;\n\t        }\n\t    }, {\n\t        key: 'setStream',\n\t        value: function setStream(stream) {\n\t            console.log('setstream');\n\t            if (stream instanceof Array) {\n\t                console.log(\"array\");\n\t                console.log(stream[0].getVideoTracks());\n\t                Array.prototype.push.apply(this.sources_, stream);\n\t            } else if (Util_1.Util.isMediaStream(stream)) {\n\t                console.log(\"stream\");\n\t                console.log(stream.getVideoTracks());\n\t                this.sources_.push(stream);\n\t            }\n\t        }\n\t    }, {\n\t        key: 'dataChannelOption',\n\t        value: function dataChannelOption() {\n\t            return this.option_;\n\t        }\n\t    }, {\n\t        key: 'setDataChannelOption',\n\t        value: function setDataChannelOption(option) {\n\t            this.option_ = option;\n\t        }\n\t    }, {\n\t        key: 'key',\n\t        value: function key() {\n\t            return Util_1.Util.key(this.peerId_, this.type_);\n\t        }\n\t    }]);\n\t\n\t    return NeighbourRecord;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\texports.NeighbourRecord = NeighbourRecord;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/main.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar online_state_1 = __webpack_require__(10);\n\tvar wait_closing_state_1 = __webpack_require__(13);\n\t\n\tvar ConnectedState = function () {\n\t    function ConnectedState() {\n\t        _classCallCheck(this, ConnectedState);\n\t    }\n\t\n\t    _createClass(ConnectedState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.connected;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (!isOnline) state.setStateObject(new wait_closing_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (!isConnected) state.setStateObject(new online_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return ConnectedState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = ConnectedState;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/main.d.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar connected_state_1 = __webpack_require__(9);\n\t\n\tvar OnlineState = function () {\n\t    function OnlineState() {\n\t        _classCallCheck(this, OnlineState);\n\t    }\n\t\n\t    _createClass(OnlineState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.online;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (!isOnline) state.setStateObject(new offline_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (isConnected) state.setStateObject(new connected_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return OnlineState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = OnlineState;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//LinkGenerator wraps PeerJs object and establish P2P Link\n\t//1. This object is created when PeerIo is initialized\n\t//2. This object is destroyed when PeerIo destroyed\n\t//3. This object may be unique, I'll make it singleton.A\n\t//4. This object has a State object that shows Online/Offline/PeerJsConnected status.\n\t//5. This object doesn't have any Neighbour's information.\n\t//    This object gets it through a delegate method in NeighbourSourceArray_\n\t//5. When client become online, it try to establish P2P link.\n\t//6. When Neighbour request this client to establish Link,\n\t//    this object create link object and hold it until 'onopen' event is fired.\n\t//7. When 'onopen' event is fired, it creates LinkComponent object and pass it to NeighbourStore object.\n\t//    NeighbourStore object may accept and decline this link.\n\t//    LinkGenerator doesn't care for it.\n\t//8. This object doesn't close Link. It only generates it.\n\t//9. This object has some streams to answer to requests from Neighbour.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar link_component_1 = __webpack_require__(7);\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar Util_1 = __webpack_require__(4);\n\tvar peer_io_1 = __webpack_require__(3);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t\n\tvar LinkGenerator = function (_eventemitter2_1$Even) {\n\t    _inherits(LinkGenerator, _eventemitter2_1$Even);\n\t\n\t    function LinkGenerator(peer_) {\n\t        _classCallCheck(this, LinkGenerator);\n\t\n\t        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(LinkGenerator).call(this));\n\t\n\t        _this.peer_ = peer_;\n\t        _this.NeighbourSourceHash_ = {};\n\t        _this.onStateChanged_ = function (state) {\n\t            switch (state) {\n\t                case peerjs_state_1.PeerJsStateEnum.initial:\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.online:\n\t                    if (!_this.peer_.disconnected) {\n\t                        _this.state_.stateObject().peer(_this.state_, true);\n\t                    }\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.connected:\n\t                    setTimeout(_this._establishAllPeer, Util_1.Util.waitTime(2000, 5000));\n\t                    break;\n\t                case peerjs_state_1.PeerJsStateEnum.wait_closing:\n\t                    break;\n\t                default:\n\t                    break;\n\t            }\n\t        };\n\t        //=============peer event and change state end===========\n\t        //=============Link generation methods start===========\n\t        _this.establishLink = function (neighbour) {\n\t            switch (neighbour.type()) {\n\t                case peer_io_1.NeighbourTypeEnum.video:\n\t                    _this.tryCall_(neighbour);\n\t                    break;\n\t                case peer_io_1.NeighbourTypeEnum.data:\n\t                    _this.tryConnect_(neighbour);\n\t                    break;\n\t            }\n\t        };\n\t        _this._establishAllPeer = function () {\n\t            _.each(_this.targetNeighbours_(), _this.establishLink);\n\t        };\n\t        _this.onRecvCall_ = function (mediaConnection) {\n\t            var neighbourID = mediaConnection.peer;\n\t            var neighbour = _this.findNeighbour_(Util_1.Util.key(neighbourID, peer_io_1.NeighbourTypeEnum.video));\n\t            var retStream = _this.defaultStream_;\n\t            if (neighbour) {\n\t                var streams = neighbour.streams();\n\t                if (streams && streams.length > 0) {\n\t                    retStream = streams[0];\n\t                }\n\t            }\n\t            mediaConnection.answer(retStream);\n\t            mediaConnection.on(\"stream\", function (stream) {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbourID, mediaConnection);\n\t                _this.emit(LinkGenerator.OnNewMediaStream, link, stream);\n\t            });\n\t        };\n\t        _this.onRecvConnect_ = function (dataConnection) {\n\t            var neighbourID = dataConnection.peer;\n\t            dataConnection.on('open', function () {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbourID, dataConnection);\n\t                _this.emit(LinkGenerator.OnNewDataChannel, link);\n\t            });\n\t        };\n\t        _this.state_ = new peerjs_state_1.PeerJsStateManager();\n\t        _this.state_.onStateChanged(_this.onStateChanged_);\n\t        _this.checkNetworkStatus_();\n\t        _this.wrapPeerEvent_();\n\t        return _this;\n\t    }\n\t\n\t    _createClass(LinkGenerator, [{\n\t        key: 'setDefaultStream',\n\t        value: function setDefaultStream(stream) {\n\t            this.defaultStream_ = stream;\n\t        }\n\t    }, {\n\t        key: 'addNeighbourSource',\n\t        value: function addNeighbourSource(key, source) {\n\t            this.NeighbourSourceHash_[key] = source;\n\t        }\n\t    }, {\n\t        key: 'removeNeighbourSource',\n\t        value: function removeNeighbourSource(key) {\n\t            if (key in this.NeighbourSourceHash_) delete this.NeighbourSourceHash_[key];\n\t        }\n\t        //=============Network and PeerJs state methods start=========\n\t\n\t    }, {\n\t        key: 'checkNetworkStatus_',\n\t        value: function checkNetworkStatus_() {\n\t            var _this2 = this;\n\t\n\t            Offline.options = { checks: { xhr: { url: 'https://skyway.io/dist/0.3/peer.min.js' } } };\n\t            Offline.on('up', function () {\n\t                _this2.state_.stateObject().network(_this2.state_, true);\n\t            });\n\t            Offline.on('down', function () {\n\t                _this2.state_.stateObject().network(_this2.state_, false);\n\t            });\n\t            if (Offline.state === 'up') {\n\t                this.state_.stateObject().network(this.state_, true);\n\t            }\n\t            Offline.check();\n\t        }\n\t    }, {\n\t        key: 'wrapPeerEvent_',\n\t        value: function wrapPeerEvent_() {\n\t            var _this3 = this;\n\t\n\t            this.peer_.on(\"open\", function () {\n\t                _this3.state_.stateObject().peer(_this3.state_, true);\n\t            });\n\t            this.peer_.on('error', function (err) {\n\t                console.log(err);\n\t            });\n\t            this.peer_.on('disconnected', function () {\n\t                _this3.state_.stateObject().peer(_this3.state_, false);\n\t            });\n\t            this.peer_.on('connection', this.onRecvConnect_);\n\t            this.peer_.on('call', this.onRecvCall_);\n\t        }\n\t    }, {\n\t        key: 'findNeighbour_',\n\t        value: function findNeighbour_(key) {\n\t            var source = _.find(this.NeighbourSourceHash_, function (item) {\n\t                return key in item();\n\t            });\n\t            if (source) return source()[key];\n\t            return null;\n\t        }\n\t    }, {\n\t        key: 'neighbourArray_',\n\t        value: function neighbourArray_() {\n\t            return _.reduce(this.NeighbourSourceHash_, function (container, val, key) {\n\t                return _.reduce(val(), function (innerContainer, record, key) {\n\t                    return innerContainer.concat(record);\n\t                }, container);\n\t            }, []);\n\t        }\n\t    }, {\n\t        key: 'targetNeighbours_',\n\t        value: function targetNeighbours_() {\n\t            var neighbours = this.neighbourArray_();\n\t            return _.filter(neighbours, function (neighbour) {\n\t                return !neighbour.isEstablished();\n\t            });\n\t        }\n\t    }, {\n\t        key: 'tryCall_',\n\t        value: function tryCall_(neighbour) {\n\t            var _this4 = this;\n\t\n\t            var streams = neighbour.streams();\n\t            var retStream = this.defaultStream_;\n\t            if (streams && streams.length > 0) retStream = streams[0];\n\t            var mediaConnection = this.peer_.call(neighbour.peerID(), retStream);\n\t            if (!mediaConnection) return;\n\t            mediaConnection.on(\"stream\", function (stream) {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbour.peerID(), mediaConnection);\n\t                _this4.emit(LinkGenerator.OnNewMediaStream, link, stream);\n\t            });\n\t        }\n\t    }, {\n\t        key: 'tryConnect_',\n\t        value: function tryConnect_(neighbour) {\n\t            var _this5 = this;\n\t\n\t            var dataConnection = this.peer_.connect(neighbour.peerID(), neighbour.dataChannelOption());\n\t            if (!dataConnection) return;\n\t            dataConnection.on('open', function () {\n\t                var link = link_component_1.LinkComponentFactory.createLinkComponent(neighbour.peerID(), dataConnection);\n\t                _this5.emit(LinkGenerator.OnNewDataChannel, link);\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return LinkGenerator;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\tLinkGenerator.OnNewMediaStream = \"on-new-mediastream-in-link_generator.ts\";\n\tLinkGenerator.OnNewDataChannel = \"on-new-datachannel-in-link_generator.ts\";\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = LinkGenerator;\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t//NeighbourStore has records and links\n\t//1. This object is created when PeerIo is initialized\n\t//2. This object is destroyed when PeerIo destroyed\n\t//3. This object may be unique, I'll make it singleton.\n\t\"use strict\";\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar neighbour_record_1 = __webpack_require__(8);\n\tvar eventemitter2_1 = __webpack_require__(1);\n\tvar _ = __webpack_require__(6);\n\t\n\tvar NeighbourStore = function (_eventemitter2_1$Even) {\n\t    _inherits(NeighbourStore, _eventemitter2_1$Even);\n\t\n\t    function NeighbourStore() {\n\t        var _Object$getPrototypeO;\n\t\n\t        _classCallCheck(this, NeighbourStore);\n\t\n\t        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n\t            args[_key] = arguments[_key];\n\t        }\n\t\n\t        var _this = _possibleConstructorReturn(this, (_Object$getPrototypeO = Object.getPrototypeOf(NeighbourStore)).call.apply(_Object$getPrototypeO, [this].concat(args)));\n\t\n\t        _this.recordsHash_ = {};\n\t        _this.linksHash_ = {};\n\t        _this.neighbours = function () {\n\t            return _this.recordsHash_;\n\t        };\n\t        return _this;\n\t    }\n\t\n\t    _createClass(NeighbourStore, [{\n\t        key: 'addRecord_',\n\t        value: function addRecord_(record) {\n\t            record.isEstablished = this.isEstablished_.bind(this, record.key());\n\t            record.addLink = this.addLink_.bind(this, record.key());\n\t            this.recordsHash_[record.key()] = record;\n\t        }\n\t    }, {\n\t        key: 'addRecord',\n\t        value: function addRecord(record) {\n\t            if (record.key() in this.recordsHash_) {\n\t                if (this.recordsHash_[record.key()].isEstablished()) {} else {\n\t                    this.emit(NeighbourStore.OnNeedEstablishLink, this.recordsHash_[record.key()]);\n\t                }\n\t            } else {\n\t                this.addRecord_(record);\n\t                this.emit(NeighbourStore.OnNeedEstablishLink, record);\n\t            }\n\t        }\n\t    }, {\n\t        key: 'removeRecord',\n\t        value: function removeRecord(record) {\n\t            if (record.key() in this.linksHash_) {\n\t                this.linksHash_[record.key()].close();\n\t                delete this.linksHash_[record.key()];\n\t            }\n\t            if (record.key() in this.recordsHash_) {\n\t                delete this.recordsHash_[record.key()];\n\t            }\n\t        }\n\t    }, {\n\t        key: 'addLink',\n\t        value: function addLink(link) {\n\t            if (!(link.key() in this.recordsHash_)) {\n\t                var record = new neighbour_record_1.NeighbourRecord(link.peerID(), link.type());\n\t                this.addRecord_(record);\n\t            }\n\t            this.linksHash_[link.key()] = link;\n\t        }\n\t    }, {\n\t        key: 'findLink',\n\t        value: function findLink(key) {\n\t            return this.linksHash_[key];\n\t        }\n\t    }, {\n\t        key: 'links',\n\t        value: function links() {\n\t            return _.reduce(this.linksHash_, function (innerContainer, record, key) {\n\t                return innerContainer.concat(record);\n\t            }, []);\n\t        }\n\t    }, {\n\t        key: 'addLink_',\n\t        value: function addLink_(key, link) {\n\t            if (this.isEstablished_(key)) this.linksHash_[key].close();\n\t            this.linksHash_[key] = link;\n\t        }\n\t    }, {\n\t        key: 'isEstablished_',\n\t        value: function isEstablished_(key) {\n\t            if (!(key in this.linksHash_)) return false;\n\t            return this.linksHash_[key].isEstablished();\n\t        }\n\t    }]);\n\t\n\t    return NeighbourStore;\n\t}(eventemitter2_1.EventEmitter2);\n\t\n\tNeighbourStore.OnNeedEstablishLink = \"on-new-datachannel-in-link_generator.ts\";\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = NeighbourStore;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t// オンライン Peer確立なし 接続要求もなし\n\t// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\t\"use strict\";\n\t/// <reference path=\"../../typings/main.d.ts\" />\n\t/// <reference path=\"./peerjs_state.ts\" />\n\t/// <reference path=\"./offline_state.ts\" />\n\t/// <reference path=\"./connected_state.ts\" />\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar peerjs_state_1 = __webpack_require__(2);\n\tvar offline_state_1 = __webpack_require__(5);\n\tvar connected_state_1 = __webpack_require__(9);\n\t\n\tvar WaitClosingState = function () {\n\t    function WaitClosingState() {\n\t        _classCallCheck(this, WaitClosingState);\n\t    }\n\t\n\t    _createClass(WaitClosingState, [{\n\t        key: 'state',\n\t        value: function state() {\n\t            return peerjs_state_1.PeerJsStateEnum.wait_closing;\n\t        }\n\t    }, {\n\t        key: 'network',\n\t        value: function network(state, isOnline) {\n\t            if (isOnline) state.setStateObject(new connected_state_1.default());\n\t        }\n\t    }, {\n\t        key: 'peer',\n\t        value: function peer(state, isConnected) {\n\t            if (!isConnected) state.setStateObject(new offline_state_1.default());\n\t        }\n\t    }]);\n\t\n\t    return WaitClosingState;\n\t}();\n\t\n\tObject.defineProperty(exports, \"__esModule\", { value: true });\n\texports.default = WaitClosingState;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\t\n\t/*! offline-js 0.7.14 */\n\t(function () {\n\t  var a, b, c, d, e, f, g;d = function d(a, b) {\n\t    var c, d, e, f;e = [];for (d in b.prototype) {\n\t      try {\n\t        f = b.prototype[d], null == a[d] && \"function\" != typeof f ? e.push(a[d] = f) : e.push(void 0);\n\t      } catch (g) {\n\t        c = g;\n\t      }\n\t    }return e;\n\t  }, a = {}, a.options = window.Offline ? window.Offline.options || {} : {}, c = { checks: { xhr: { url: function url() {\n\t          return \"/favicon.ico?_=\" + new Date().getTime();\n\t        }, timeout: 5e3, type: \"HEAD\" }, image: { url: function url() {\n\t          return \"/favicon.ico?_=\" + new Date().getTime();\n\t        } }, active: \"xhr\" }, checkOnLoad: !1, interceptRequests: !0, reconnect: !0, deDupBody: !1 }, e = function e(a, b) {\n\t    var c, d, e, f, g, h;for (c = a, h = b.split(\".\"), d = e = 0, f = h.length; f > e && (g = h[d], c = c[g], \"object\" == (typeof c === \"undefined\" ? \"undefined\" : _typeof(c))); d = ++e) {}return d === h.length - 1 ? c : void 0;\n\t  }, a.getOption = function (b) {\n\t    var d, f;return f = null != (d = e(a.options, b)) ? d : e(c, b), \"function\" == typeof f ? f() : f;\n\t  }, \"function\" == typeof window.addEventListener && window.addEventListener(\"online\", function () {\n\t    return setTimeout(a.confirmUp, 100);\n\t  }, !1), \"function\" == typeof window.addEventListener && window.addEventListener(\"offline\", function () {\n\t    return a.confirmDown();\n\t  }, !1), a.state = \"up\", a.markUp = function () {\n\t    return a.trigger(\"confirmed-up\"), \"up\" !== a.state ? (a.state = \"up\", a.trigger(\"up\")) : void 0;\n\t  }, a.markDown = function () {\n\t    return a.trigger(\"confirmed-down\"), \"down\" !== a.state ? (a.state = \"down\", a.trigger(\"down\")) : void 0;\n\t  }, f = {}, a.on = function (b, c, d) {\n\t    var e, g, h, i, j;if (g = b.split(\" \"), g.length > 1) {\n\t      for (j = [], h = 0, i = g.length; i > h; h++) {\n\t        e = g[h], j.push(a.on(e, c, d));\n\t      }return j;\n\t    }return null == f[b] && (f[b] = []), f[b].push([d, c]);\n\t  }, a.off = function (a, b) {\n\t    var c, d, e, g, h;if (null != f[a]) {\n\t      if (b) {\n\t        for (e = 0, h = []; e < f[a].length;) {\n\t          g = f[a][e], d = g[0], c = g[1], c === b ? h.push(f[a].splice(e, 1)) : h.push(e++);\n\t        }return h;\n\t      }return f[a] = [];\n\t    }\n\t  }, a.trigger = function (a) {\n\t    var b, c, d, e, g, h, i;if (null != f[a]) {\n\t      for (g = f[a], i = [], d = 0, e = g.length; e > d; d++) {\n\t        h = g[d], b = h[0], c = h[1], i.push(c.call(b));\n\t      }return i;\n\t    }\n\t  }, b = function b(a, _b, c) {\n\t    var d, e, f, g, h;return h = function h() {\n\t      return a.status && a.status < 12e3 ? _b() : c();\n\t    }, null === a.onprogress ? (d = a.onerror, a.onerror = function () {\n\t      return c(), \"function\" == typeof d ? d.apply(null, arguments) : void 0;\n\t    }, g = a.ontimeout, a.ontimeout = function () {\n\t      return c(), \"function\" == typeof g ? g.apply(null, arguments) : void 0;\n\t    }, e = a.onload, a.onload = function () {\n\t      return h(), \"function\" == typeof e ? e.apply(null, arguments) : void 0;\n\t    }) : (f = a.onreadystatechange, a.onreadystatechange = function () {\n\t      return 4 === a.readyState ? h() : 0 === a.readyState && c(), \"function\" == typeof f ? f.apply(null, arguments) : void 0;\n\t    });\n\t  }, a.checks = {}, a.checks.xhr = function () {\n\t    var c, d;d = new XMLHttpRequest(), d.offline = !1, d.open(a.getOption(\"checks.xhr.type\"), a.getOption(\"checks.xhr.url\"), !0), null != d.timeout && (d.timeout = a.getOption(\"checks.xhr.timeout\")), b(d, a.markUp, a.markDown);try {\n\t      d.send();\n\t    } catch (e) {\n\t      c = e, a.markDown();\n\t    }return d;\n\t  }, a.checks.image = function () {\n\t    var b;return b = document.createElement(\"img\"), b.onerror = a.markDown, b.onload = a.markUp, void (b.src = a.getOption(\"checks.image.url\"));\n\t  }, a.checks.down = a.markDown, a.checks.up = a.markUp, a.check = function () {\n\t    return a.trigger(\"checking\"), a.checks[a.getOption(\"checks.active\")]();\n\t  }, a.confirmUp = a.confirmDown = a.check, a.onXHR = function (a) {\n\t    var b, c, e;return e = function e(b, c) {\n\t      var d;return d = b.open, b.open = function (e, f, g, h, i) {\n\t        return a({ type: e, url: f, async: g, flags: c, user: h, password: i, xhr: b }), d.apply(b, arguments);\n\t      };\n\t    }, c = window.XMLHttpRequest, window.XMLHttpRequest = function (a) {\n\t      var b, d, f;return f = new c(a), e(f, a), d = f.setRequestHeader, f.headers = {}, f.setRequestHeader = function (a, b) {\n\t        return f.headers[a] = b, d.call(f, a, b);\n\t      }, b = f.overrideMimeType, f.overrideMimeType = function (a) {\n\t        return f.mimeType = a, b.call(f, a);\n\t      }, f;\n\t    }, d(window.XMLHttpRequest, c), null != window.XDomainRequest ? (b = window.XDomainRequest, window.XDomainRequest = function () {\n\t      var a;return a = new b(), e(a), a;\n\t    }, d(window.XDomainRequest, b)) : void 0;\n\t  }, g = function g() {\n\t    return a.getOption(\"interceptRequests\") && a.onXHR(function (c) {\n\t      var d;return d = c.xhr, d.offline !== !1 ? b(d, a.markUp, a.confirmDown) : void 0;\n\t    }), a.getOption(\"checkOnLoad\") ? a.check() : void 0;\n\t  }, setTimeout(g, 0), window.Offline = a;\n\t}).call(undefined), function () {\n\t  var a, b, c, d, e, f, g, h, i;if (!window.Offline) throw new Error(\"Offline Reconnect brought in without offline.js\");d = Offline.reconnect = {}, f = null, e = function e() {\n\t    var a;return null != d.state && \"inactive\" !== d.state && Offline.trigger(\"reconnect:stopped\"), d.state = \"inactive\", d.remaining = d.delay = null != (a = Offline.getOption(\"reconnect.initialDelay\")) ? a : 3;\n\t  }, b = function b() {\n\t    var a, b;return a = null != (b = Offline.getOption(\"reconnect.delay\")) ? b : Math.min(Math.ceil(1.5 * d.delay), 3600), d.remaining = d.delay = a;\n\t  }, g = function g() {\n\t    return \"connecting\" !== d.state ? (d.remaining -= 1, Offline.trigger(\"reconnect:tick\"), 0 === d.remaining ? h() : void 0) : void 0;\n\t  }, h = function h() {\n\t    return \"waiting\" === d.state ? (Offline.trigger(\"reconnect:connecting\"), d.state = \"connecting\", Offline.check()) : void 0;\n\t  }, a = function a() {\n\t    return Offline.getOption(\"reconnect\") ? (e(), d.state = \"waiting\", Offline.trigger(\"reconnect:started\"), f = setInterval(g, 1e3)) : void 0;\n\t  }, i = function i() {\n\t    return null != f && clearInterval(f), e();\n\t  }, c = function c() {\n\t    return Offline.getOption(\"reconnect\") && \"connecting\" === d.state ? (Offline.trigger(\"reconnect:failure\"), d.state = \"waiting\", b()) : void 0;\n\t  }, d.tryNow = h, e(), Offline.on(\"down\", a), Offline.on(\"confirmed-down\", c), Offline.on(\"up\", i);\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e, f;if (!window.Offline) throw new Error(\"Requests module brought in without offline.js\");c = [], f = !1, d = function d(a) {\n\t    return Offline.getOption(\"requests\") !== !1 ? (Offline.trigger(\"requests:capture\"), \"down\" !== Offline.state && (f = !0), c.push(a)) : void 0;\n\t  }, e = function e(a) {\n\t    var b, c, d, e, f, g, h, i, j;if (j = a.xhr, g = a.url, f = a.type, h = a.user, d = a.password, b = a.body, Offline.getOption(\"requests\") !== !1) {\n\t      j.abort(), j.open(f, g, !0, h, d), e = j.headers;for (c in e) {\n\t        i = e[c], j.setRequestHeader(c, i);\n\t      }return j.mimeType && j.overrideMimeType(j.mimeType), j.send(b);\n\t    }\n\t  }, a = function a() {\n\t    return c = [];\n\t  }, b = function b() {\n\t    var b, d, f, g, h, i, j;if (Offline.getOption(\"requests\") !== !1) {\n\t      for (Offline.trigger(\"requests:flush\"), i = {}, d = 0, g = c.length; g > d; d++) {\n\t        h = c[d], j = h.url.replace(/(\\?|&)_=[0-9]+/, function (a, b) {\n\t          return \"?\" === b ? b : \"\";\n\t        }), Offline.getOption(\"deDupBody\") ? (b = h.body, b = \"[object Object]\" === b.toString() ? JSON.stringify(b) : b.toString(), i[h.type.toUpperCase() + \" - \" + j + \" - \" + b] = h) : i[h.type.toUpperCase() + \" - \" + j] = h;\n\t      }for (f in i) {\n\t        h = i[f], e(h);\n\t      }return a();\n\t    }\n\t  }, setTimeout(function () {\n\t    return Offline.getOption(\"requests\") !== !1 ? (Offline.on(\"confirmed-up\", function () {\n\t      return f ? (f = !1, a()) : void 0;\n\t    }), Offline.on(\"up\", b), Offline.on(\"down\", function () {\n\t      return f = !1;\n\t    }), Offline.onXHR(function (a) {\n\t      var b, c, e, f, g;return g = a.xhr, e = a.async, g.offline !== !1 && (f = function f() {\n\t        return d(a);\n\t      }, c = g.send, g.send = function (b) {\n\t        return a.body = b, c.apply(g, arguments);\n\t      }, e) ? null === g.onprogress ? (g.addEventListener(\"error\", f, !1), g.addEventListener(\"timeout\", f, !1)) : (b = g.onreadystatechange, g.onreadystatechange = function () {\n\t        return 0 === g.readyState ? f() : 4 === g.readyState && (0 === g.status || g.status >= 12e3) && f(), \"function\" == typeof b ? b.apply(null, arguments) : void 0;\n\t      }) : void 0;\n\t    }), Offline.requests = { flush: b, clear: a }) : void 0;\n\t  }, 0);\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e;if (!Offline) throw new Error(\"Offline simulate brought in without offline.js\");for (d = [\"up\", \"down\"], b = 0, c = d.length; c > b; b++) {\n\t    e = d[b], (document.querySelector(\"script[data-simulate='\" + e + \"']\") || (\"undefined\" != typeof localStorage && null !== localStorage ? localStorage.OFFLINE_SIMULATE : void 0) === e) && (null == Offline.options && (Offline.options = {}), null == (a = Offline.options).checks && (a.checks = {}), Offline.options.checks.active = e);\n\t  }\n\t}.call(undefined), function () {\n\t  var a, b, c, d, e, f, g, h, i, j, k, l, m;if (!window.Offline) throw new Error(\"Offline UI brought in without offline.js\");b = '<div class=\"offline-ui\"><div class=\"offline-ui-content\"></div></div>', a = '<a href class=\"offline-ui-retry\"></a>', f = function f(a) {\n\t    var b;return b = document.createElement(\"div\"), b.innerHTML = a, b.children[0];\n\t  }, g = e = null, d = function d(a) {\n\t    return k(a), g.className += \" \" + a;\n\t  }, k = function k(a) {\n\t    return g.className = g.className.replace(new RegExp(\"(^| )\" + a.split(\" \").join(\"|\") + \"( |$)\", \"gi\"), \" \");\n\t  }, i = {}, h = function h(a, b) {\n\t    return d(a), null != i[a] && clearTimeout(i[a]), i[a] = setTimeout(function () {\n\t      return k(a), delete i[a];\n\t    }, 1e3 * b);\n\t  }, m = function m(a) {\n\t    var b, c, d, e;d = { day: 86400, hour: 3600, minute: 60, second: 1 };for (c in d) {\n\t      if (b = d[c], a >= b) return e = Math.floor(a / b), [e, c];\n\t    }return [\"now\", \"\"];\n\t  }, l = function l() {\n\t    var c, h;return g = f(b), document.body.appendChild(g), null != Offline.reconnect && Offline.getOption(\"reconnect\") && (g.appendChild(f(a)), c = g.querySelector(\".offline-ui-retry\"), h = function h(a) {\n\t      return a.preventDefault(), Offline.reconnect.tryNow();\n\t    }, null != c.addEventListener ? c.addEventListener(\"click\", h, !1) : c.attachEvent(\"click\", h)), d(\"offline-ui-\" + Offline.state), e = g.querySelector(\".offline-ui-content\");\n\t  }, j = function j() {\n\t    return l(), Offline.on(\"up\", function () {\n\t      return k(\"offline-ui-down\"), d(\"offline-ui-up\"), h(\"offline-ui-up-2s\", 2), h(\"offline-ui-up-5s\", 5);\n\t    }), Offline.on(\"down\", function () {\n\t      return k(\"offline-ui-up\"), d(\"offline-ui-down\"), h(\"offline-ui-down-2s\", 2), h(\"offline-ui-down-5s\", 5);\n\t    }), Offline.on(\"reconnect:connecting\", function () {\n\t      return d(\"offline-ui-connecting\"), k(\"offline-ui-waiting\");\n\t    }), Offline.on(\"reconnect:tick\", function () {\n\t      var a, b, c;return d(\"offline-ui-waiting\"), k(\"offline-ui-connecting\"), a = m(Offline.reconnect.remaining), b = a[0], c = a[1], e.setAttribute(\"data-retry-in-value\", b), e.setAttribute(\"data-retry-in-unit\", c);\n\t    }), Offline.on(\"reconnect:stopped\", function () {\n\t      return k(\"offline-ui-connecting offline-ui-waiting\"), e.setAttribute(\"data-retry-in-value\", null), e.setAttribute(\"data-retry-in-unit\", null);\n\t    }), Offline.on(\"reconnect:failure\", function () {\n\t      return h(\"offline-ui-reconnect-failed-2s\", 2), h(\"offline-ui-reconnect-failed-5s\", 5);\n\t    }), Offline.on(\"reconnect:success\", function () {\n\t      return h(\"offline-ui-reconnect-succeeded-2s\", 2), h(\"offline-ui-reconnect-succeeded-5s\", 5);\n\t    });\n\t  }, \"complete\" === document.readyState ? j() : null != document.addEventListener ? document.addEventListener(\"DOMContentLoaded\", j, !1) : (c = document.onreadystatechange, document.onreadystatechange = function () {\n\t    return \"complete\" === document.readyState && j(), \"function\" == typeof c ? c.apply(null, arguments) : void 0;\n\t  });\n\t}.call(undefined);\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** peer.io.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"dist/npm\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap b71b58a08c01d7386f01\n **/","module.exports = require(\"eventemitter2\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"eventemitter2\"\n ** module id = 1\n ** module chunks = 0\n **/","// NetworkのOn/Off, PeerJsのcon/disconnect, neighbourへの接続要求を管理するstate\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/main.d.ts\" />\nimport OfflineState from './offline_state';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport enum PeerJsStateEnum{\n  initial = 1,\n  online = 2,\n  connected = 3,\n  wait_closing = 4\n}\n\nexport class PeerJsStateManager extends EventEmitter2{\n  private _state: PeerJsStateIf;\n  private _ON_STATE_CHANGED = \"onStateCahnged\";\n\n  constructor(){\n    super();\n    this._state = new OfflineState();\n  }\n\n  state(): PeerJsStateEnum{\n    return this._state.state();\n  }\n\n  stateObject(): PeerJsStateIf{\n    return this._state;\n  }\n\n  setStateObject(state: PeerJsStateIf){\n    this._state = state;\n    this.emit(this._ON_STATE_CHANGED, state.state());\n  }\n\n  onStateChanged(callback: (status: PeerJsStateEnum)=>void){\n    this.on(this._ON_STATE_CHANGED, callback);\n  }\n}\n\nexport interface PeerJsStateIf{\n  state(): PeerJsStateEnum;\n  network(state: PeerJsStateManager, isOnline: boolean): void;\n  peer(state: PeerJsStateManager, isConnected: boolean): void;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/peerjs_state.ts\n **/","// Main Controller\n\n/// <reference path=\"../typings/main.d.ts\" />\nimport {Util} from './Util';\nimport {NeighbourRecord, NeighbourSource, NeighbourHash} from './neighbour_record';\nimport NeighbourStore from './neighbour_store'\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport LinkGenerator from './link_generator';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport enum NeighbourTypeEnum {\n    video = 1,\n    data = 2\n}\n\nexport var OnStartVideo = \"onStartVideo-in-peer.io.ts\";\nexport var OnStopVideo = \"onStopVideo-in-peer.io.ts\";\nexport var OnDataLinkUp = \"onDataLinkUp\";\nexport var OnDataLinkDown = \"onDataLinkDown\";\nexport var OnRecvData = \"onRecvData\";\n\nexport class PeerIo extends EventEmitter2 {\n    private linkGenerator_: LinkGenerator;\n    private neighbourStore_: NeighbourStore;\n\n    //================= setup ==================\n    constructor(private peerJs_: PeerJs.Peer) {\n        super();\n        this.neighbourStore_ = new NeighbourStore();\n        this.linkGenerator_ = new LinkGenerator(peerJs_);\n        this.linkGenerator_.addNeighbourSource(\"neighbourSource\", this.neighbourStore_.neighbours);\n        this.linkGenerator_.on(LinkGenerator.OnNewDataChannel, this.newDataChannel_);\n        this.linkGenerator_.on(LinkGenerator.OnNewMediaStream, this.newMediaStream_);\n        this.neighbourStore_.on(NeighbourStore.OnNeedEstablishLink, this.linkGenerator_.establishLink);\n    }\n\n    private newDataChannel_ = (link: DataLinkComponent) => {\n        this.neighbourStore_.addLink(link);\n        this.emit(OnDataLinkUp, link.peerID(), link.options());\n        link.on(LinkComponentTemplate.OnRecvData, (data) => {\n            this.emit(OnRecvData, link.peerID(), data);\n        });\n\n        link.on(LinkComponentTemplate.OnDataLinkDown, () => {\n            this.emit(OnStopVideo, link.peerID());\n        });\n    };\n\n    private newMediaStream_ = (link: VideoLinkComponent, stream: MediaStream) => {\n        this.neighbourStore_.addLink(link);\n        this.emit(OnStartVideo, link.peerID(), stream);\n        link.on(LinkComponentTemplate.OnStopVideo, () => {\n            this.emit(OnStopVideo, link.peerID());\n        });\n    };\n\n    addDefaultStream(mediaStream: MediaStream) {\n        this.linkGenerator_.setDefaultStream(mediaStream);\n    }\n\n    addVideoNeighbour(peerId: string, stream?: MediaStream | MediaStream[]) {\n        var neighbour = new NeighbourRecord(peerId, NeighbourTypeEnum.video);\n        if (stream) neighbour.setStream(stream);\n        this.neighbourStore_.addRecord(neighbour);\n    }\n\n    addDataNeighbour(peerId: string, option?: PeerConnectOption) {\n        var neighbour = new NeighbourRecord(peerId, NeighbourTypeEnum.data);\n        if (option) neighbour.setDataChannelOption(option);\n        this.neighbourStore_.addRecord(neighbour);\n    }\n\n    removeVideoNeighbour(peerId: string) {\n        this.neighbourStore_.removeRecord(new NeighbourRecord(peerId, NeighbourTypeEnum.video));\n    }\n\n    removeDataNeighbour(peerId: string) {\n        this.neighbourStore_.removeRecord(new NeighbourRecord(peerId, NeighbourTypeEnum.data));\n    }\n\n    //================= setup ==================\n\n    //================= data channel ===========\n    send(peerId: string, message: string) {\n        var target = this.neighbourStore_.findLink(peerId + \"-data\");\n        if (target) target.send(message);\n    }\n\n    broadcast(message: string) {\n        var neighbours = this.neighbourStore_.links();\n        _.each(neighbours, (link) => {\n            link.send(message);\n        });\n    }\n    //================= data channel ===========\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/peer.io.ts\n **/","import * as Record from './neighbour_record';\nimport {NeighbourTypeEnum} from './peer.io';\nexport type Link = PeerJs.DataConnection | PeerJs.MediaConnection;\n\nexport class Util {\n    static waitTime(min: number, max: number): number {\n        return min + Math.random() * (max - min);\n    }\n\n    static key(peerID: string, type: NeighbourTypeEnum) {\n        switch (type) {\n            case NeighbourTypeEnum.video:\n                return peerID + \"-video\";\n            case NeighbourTypeEnum.data:\n                return peerID + \"-data\";\n        }\n    }\n\n    static isDataChannel(link: Link): link is PeerJs.DataConnection {\n        return link && link.hasOwnProperty('reliable');\n    }\n\n    static isMediaConnection(link: Link): link is PeerJs.MediaConnection {\n        return link && link.hasOwnProperty('localStream');\n    }\n\n    static isMediaStream(stream: any): stream is MediaStream {\n        return stream && ('active' in stream) && ('id' in stream);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Util.ts\n **/","// オフライン Peer確立なし 接続要求もなし\n// 初期状態\n\n/// <reference path=\"../../typings/main.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OnlineState from './online_state';\nimport ConnectedState from './connected_state';\n\nexport default class OfflineState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.initial };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(isOnline) state.setStateObject(new OnlineState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    //オフライン状態でpeerjsのステータスは変わらないので無視\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/offline_state.ts\n **/","module.exports = require(\"lodash\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"lodash\"\n ** module id = 6\n ** module chunks = 0\n **/","//It is a component which wraps Link(MediaStream of DataChannel)\n//1. This object is created when Link is established.\n//2. This object is created only by LinkComponentFactory\n//3. When Link become down, this component is destroyed\n\n/// <reference path=\"../typings/main.d.ts\" />\nimport * as Record from './neighbour_record';\nimport {Util, Link} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\n\nexport interface PeerConnectOption {\n    label?: string;\n    metadata?: any;\n    serialization?: string;\n    reliable?: boolean;\n}\n\nexport class LinkComponentTemplate extends EventEmitter2 {\n    static OnStopVideo = \"onStopVideo-in-peer.io.ts\";\n    static OnDataLinkDown = \"onDataLinkDown-in-link_component.ts\";\n    static OnRecvData = \"onRecvData-in-link_component.ts\";\n\n    constructor(protected peerID_: string, protected link_: Link) {\n        super();\n    }\n\n    type(): NeighbourTypeEnum { return null; }\n\n    peerID(): string { return this.peerID_; };\n\n    key(): string { return Util.key(this.peerID_, this.type()); }\n\n    isEstablished(): boolean { return false; }\n\n    send(message: string): void { }\n\n    close(): void { }\n}\n\nexport class DataLinkComponent extends LinkComponentTemplate {\n    constructor(protected peerID_, protected link_: PeerJs.DataConnection) {\n        super(peerID_, link_);\n\n        link_.on('close', () => {\n            this.link_ = null;\n            this.emit(LinkComponentTemplate.OnDataLinkDown);\n        });\n\n        link_.on('error', (error) => {\n            this.link_ = null;\n        });\n\n        link_.on('data', (data: string) => {\n            this.emit(LinkComponentTemplate.OnRecvData, data);\n        });\n    }\n\n    type() {\n        return NeighbourTypeEnum.data;\n    }\n\n    isEstablished(): boolean {\n        if (!this.link_) return false;\n        if (!this.link_.open) return false;\n        return this.link_.open;\n    }\n\n    send(message: string) {\n        if (!this.isEstablished() || !this.link_) return;\n        this.link_.send(message);\n    }\n\n    close() {\n        if (this.link_) this.link_.close();\n        this.link_ = null;\n    }\n\n    options(): PeerConnectOption {\n        return {\n            metadata: this.link_.metadata,\n            serialization: this.link_.serialization,\n            reliable: this.link_.reliable\n        };\n    }\n}\n\nexport class VideoLinkComponent extends LinkComponentTemplate {\n    private _sources: Array<MediaStream> = [];\n\n    constructor(protected peerID_, protected link_: PeerJs.MediaConnection) {\n        super(peerID_, link_);\n\n        link_.on('close', () => {\n            this.link_ = null;\n            this.emit(LinkComponentTemplate.OnStopVideo);\n        });\n\n        link_.on('error', (error) => {\n            this.link_ = null;\n        });\n    }\n\n    type() {\n        return NeighbourTypeEnum.video;\n    }\n\n    isEstablished(): boolean {\n        if (!this.link_) return false;\n        if (!this.link_.open) return false;\n        return this.link_.open;\n    }\n\n    sources() {\n        return this._sources;\n    }\n\n    setSource(source: MediaStream | Array<MediaStream>) {\n        if (source instanceof Array) Array.prototype.push.apply(this._sources, source);\n        else this._sources.push(<MediaStream>source);\n    }\n\n    close() {\n        if (this.link_) this.link_.close();\n        this.link_ = null;\n    }\n}\n\nexport class LinkComponentFactory {\n    static createLinkComponent(peerID: string, link: Link): LinkComponentTemplate {\n        if (Util.isDataChannel(link)) {\n            return new DataLinkComponent(peerID, link);\n        } else if (Util.isMediaConnection(link)) {\n            return new VideoLinkComponent(peerID, link);\n        }\n        return null;\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/link_component.ts\n **/","//NeighbourRecord is just a record.\n//It shows an Neighbour which LinkGenerator should establish a link to.\n//1. This object is created when user add an Neighbour.\n//2. This object is destroyed when user remove it.\n//3. This object has some delegated method.\n\n/// <reference path=\"../typings/main.d.ts\" />\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {Util} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\n\nexport type NeighbourHash = { [key: string]: NeighbourRecord };\nexport type NeighbourSource = () => NeighbourHash;\n\nexport class NeighbourRecord extends EventEmitter2 {\n    private sources_: MediaStream[] = [];\n    private option_: PeerJs.PeerConnectOption = {\n        label: 'json',\n        serialization: 'none',\n        reliable: false\n    };\n\n    constructor(private peerId_: string, private type_: NeighbourTypeEnum) {\n        super();\n        console.log(\"create neighbour record \" + peerId_ + \" type \" + type_);\n    }\n\n    type() { return this.type_; }\n\n    peerID(): string { return this.peerId_; }\n\n    streams(): MediaStream[] {\n        return this.sources_;\n    }\n\n    setStream(stream: MediaStream | MediaStream[]) {\n        console.log('setstream');\n        if (stream instanceof Array) {\n            console.log(\"array\");\n            console.log(stream[0].getVideoTracks());\n            Array.prototype.push.apply(this.sources_, stream);\n        } else if (Util.isMediaStream(stream)) {\n            console.log(\"stream\");\n            console.log(stream.getVideoTracks());\n            this.sources_.push(stream);\n        }\n    }\n\n    dataChannelOption(): PeerJs.PeerConnectOption {\n        return this.option_;\n    }\n\n    setDataChannelOption(option: PeerJs.PeerConnectOption) {\n        this.option_ = option;\n    }\n\n    //delegate\n    isEstablished: () => boolean = () => {\n        //throw(\"this method should be overwrite.\");\n        return false;\n    };\n\n    //delegate\n    addLink = (link: LinkComponentTemplate) => {\n        throw (\"this method should be overwrite.\");\n    };\n\n    key(): string {\n        return Util.key(this.peerId_, this.type_);\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/neighbour_record.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/main.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OnlineState from './online_state';\nimport WaitClosingState from './wait_closing_state';\n\nexport default class ConnectedState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.connected };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(!isOnline) state.setStateObject(new WaitClosingState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(!isConnected) state.setStateObject(new OnlineState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/connected_state.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/main.d.ts\" />\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OfflineState from './offline_state';\nimport ConnectedState from './connected_state';\n\nexport default class OnlineState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.online };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(!isOnline) state.setStateObject(new OfflineState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(isConnected) state.setStateObject(new ConnectedState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/online_state.ts\n **/","//LinkGenerator wraps PeerJs object and establish P2P Link\n//1. This object is created when PeerIo is initialized\n//2. This object is destroyed when PeerIo destroyed\n//3. This object may be unique, I'll make it singleton.A\n//4. This object has a State object that shows Online/Offline/PeerJsConnected status.\n//5. This object doesn't have any Neighbour's information.\n//    This object gets it through a delegate method in NeighbourSourceArray_\n//5. When client become online, it try to establish P2P link.\n//6. When Neighbour request this client to establish Link,\n//    this object create link object and hold it until 'onopen' event is fired.\n//7. When 'onopen' event is fired, it creates LinkComponent object and pass it to NeighbourStore object.\n//    NeighbourStore object may accept and decline this link.\n//    LinkGenerator doesn't care for it.\n//8. This object doesn't close Link. It only generates it.\n//9. This object has some streams to answer to requests from Neighbour.\n\n/// <reference path=\"../typings/main.d.ts\" />\nimport {NeighbourRecord, NeighbourSource} from './neighbour_record';\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {PeerJsStateManager, PeerJsStateEnum} from './states/peerjs_state';\nimport {Util} from './Util';\nimport {NeighbourTypeEnum} from './peer.io';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport default class LinkGenerator extends EventEmitter2 {\n    static OnNewMediaStream = \"on-new-mediastream-in-link_generator.ts\";\n    static OnNewDataChannel = \"on-new-datachannel-in-link_generator.ts\";\n    private state_: PeerJsStateManager;\n    private NeighbourSourceHash_: { [key: string]: NeighbourSource } = {};\n    private defaultStream_: MediaStream;\n\n    constructor(private peer_: PeerJs.Peer) {\n        super();\n\n        this.state_ = new PeerJsStateManager();\n        this.state_.onStateChanged(this.onStateChanged_);\n\n        this.checkNetworkStatus_();\n        this.wrapPeerEvent_();\n    }\n\n    setDefaultStream(stream: MediaStream) {\n        this.defaultStream_ = stream;\n    }\n\n    addNeighbourSource(key: string, source: NeighbourSource) {\n        this.NeighbourSourceHash_[key] = source;\n    }\n\n    removeNeighbourSource(key: string) {\n        if (key in this.NeighbourSourceHash_) delete this.NeighbourSourceHash_[key];\n    }\n\n    //=============Network and PeerJs state methods start=========\n\n    private checkNetworkStatus_() {\n        (<any>Offline).options = { checks: { xhr: { url: 'https://skyway.io/dist/0.3/peer.min.js' } } };\n\n        Offline.on('up', () => {\n            this.state_.stateObject().network(this.state_, true);\n        });\n\n        Offline.on('down', () => {\n            this.state_.stateObject().network(this.state_, false);\n        });\n\n        if (Offline.state === 'up') {\n            this.state_.stateObject().network(this.state_, true);\n        }\n\n        Offline.check();\n    }\n\n    private onStateChanged_ = (state: PeerJsStateEnum) => {\n        switch (state) {\n            case PeerJsStateEnum.initial:\n                break;\n            case PeerJsStateEnum.online:\n                if (!this.peer_.disconnected) {\n                    this.state_.stateObject().peer(this.state_, true);\n                }\n                break;\n            case PeerJsStateEnum.connected:\n                setTimeout(this._establishAllPeer, Util.waitTime(2000, 5000));\n                break;\n            case PeerJsStateEnum.wait_closing:\n                break;\n            default:\n                break;\n        }\n    };\n\n    private wrapPeerEvent_() {\n        this.peer_.on(\"open\", () => {\n            this.state_.stateObject().peer(this.state_, true);\n        });\n        this.peer_.on('error', (err) => { console.log(err); });\n        this.peer_.on('disconnected', () => {\n            this.state_.stateObject().peer(this.state_, false);\n        });\n        this.peer_.on('connection', this.onRecvConnect_);\n        this.peer_.on('call', this.onRecvCall_);\n    }\n\n    //=============peer event and change state end===========\n\n    //=============Link generation methods start===========\n\n    establishLink = (neighbour: NeighbourRecord) => {\n        switch (neighbour.type()) {\n            case NeighbourTypeEnum.video:\n                this.tryCall_(neighbour);\n                break;\n            case NeighbourTypeEnum.data:\n                this.tryConnect_(neighbour);\n                break;\n        }\n    };\n\n    private findNeighbour_(key: string): NeighbourRecord {\n        var source = _.find(this.NeighbourSourceHash_, (item: NeighbourSource) => {\n            return key in item();\n        });\n        if (source) return source()[key];\n        return null;\n    }\n\n    private neighbourArray_(): Array<NeighbourRecord> {\n        return _.reduce(this.NeighbourSourceHash_, (container: Array<NeighbourRecord>, val: NeighbourSource, key: string) => {\n            return _.reduce(val(), (innerContainer: Array<NeighbourRecord>, record: NeighbourRecord, key: string) => {\n                return innerContainer.concat(record);\n            }, container);\n        }, []);\n    }\n\n    private targetNeighbours_(): Array<NeighbourRecord> {\n        var neighbours = this.neighbourArray_();\n        return _.filter(neighbours, (neighbour: NeighbourRecord) => {\n            return !neighbour.isEstablished();\n        });\n    }\n\n    private _establishAllPeer = () => {\n        _.each(this.targetNeighbours_(), this.establishLink);\n    };\n\n    private tryCall_(neighbour: NeighbourRecord) {\n        var streams = neighbour.streams();\n        var retStream = this.defaultStream_;\n        if (streams && streams.length > 0) retStream = streams[0];\n        var mediaConnection = this.peer_.call(neighbour.peerID(), retStream);\n        if (!mediaConnection) return;\n        mediaConnection.on(\"stream\", (stream: MediaStream) => {\n            var link = LinkComponentFactory.createLinkComponent(neighbour.peerID(), mediaConnection);\n            this.emit(LinkGenerator.OnNewMediaStream, link, stream);\n        });\n    }\n\n    private onRecvCall_ = (mediaConnection: PeerJs.MediaConnection) => {\n        var neighbourID = mediaConnection.peer;\n        var neighbour = this.findNeighbour_(Util.key(neighbourID, NeighbourTypeEnum.video));\n        var retStream = this.defaultStream_;\n        if (neighbour) {\n            var streams = neighbour.streams();\n            if (streams && streams.length > 0) {\n                retStream = streams[0];\n            }\n        }\n        mediaConnection.answer(retStream);\n        mediaConnection.on(\"stream\", (stream: MediaStream) => {\n            var link = LinkComponentFactory.createLinkComponent(neighbourID, mediaConnection);\n            this.emit(LinkGenerator.OnNewMediaStream, link, stream);\n        });\n    };\n\n    private tryConnect_(neighbour: NeighbourRecord) {\n        var dataConnection = this.peer_.connect(neighbour.peerID(), neighbour.dataChannelOption());\n        if (!dataConnection) return;\n        dataConnection.on('open', () => {\n            var link = LinkComponentFactory.createLinkComponent(neighbour.peerID(), dataConnection);\n            this.emit(LinkGenerator.OnNewDataChannel, link);\n        });\n    }\n\n    private onRecvConnect_ = (dataConnection: PeerJs.DataConnection) => {\n        var neighbourID = dataConnection.peer;\n        dataConnection.on('open', () => {\n            var link = LinkComponentFactory.createLinkComponent(neighbourID, dataConnection);\n            this.emit(LinkGenerator.OnNewDataChannel, link);\n        });\n    };\n    //=============Link generation methods end===========\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/link_generator.ts\n **/","//NeighbourStore has records and links\n//1. This object is created when PeerIo is initialized\n//2. This object is destroyed when PeerIo destroyed\n//3. This object may be unique, I'll make it singleton.\n\n/// <reference path=\"../typings/main.d.ts\" />\nimport {NeighbourTypeEnum} from './peer.io';\nimport {NeighbourRecord, NeighbourHash} from './neighbour_record';\nimport {PeerConnectOption, LinkComponentTemplate, DataLinkComponent, VideoLinkComponent, LinkComponentFactory} from './link_component';\nimport {EventEmitter2} from 'eventemitter2';\nimport * as _ from \"lodash\";\n\nexport default class NeighbourStore extends EventEmitter2 {\n    static OnNeedEstablishLink = \"on-new-datachannel-in-link_generator.ts\";\n    private recordsHash_: NeighbourHash = {};\n    private linksHash_: { [key: string]: LinkComponentTemplate } = {};\n\n    private addRecord_(record: NeighbourRecord) {\n        record.isEstablished = this.isEstablished_.bind(this, record.key());\n        record.addLink = this.addLink_.bind(this, record.key());\n        this.recordsHash_[record.key()] = record;\n    }\n\n    addRecord(record: NeighbourRecord) {\n        if (record.key() in this.recordsHash_) {\n            if (this.recordsHash_[record.key()].isEstablished()) {\n                // already connected to the peer\n                // ignore addrecord in this case\n            } else {\n                this.emit(NeighbourStore.OnNeedEstablishLink, this.recordsHash_[record.key()]);\n            }\n        } else {\n            this.addRecord_(record);\n            this.emit(NeighbourStore.OnNeedEstablishLink, record);\n        }\n    }\n\n    removeRecord(record: NeighbourRecord) {\n        if (record.key() in this.linksHash_) {\n            this.linksHash_[record.key()].close();\n            delete this.linksHash_[record.key()];\n        }\n\n        if (record.key() in this.recordsHash_) {\n            delete this.recordsHash_[record.key()];\n        }\n    }\n\n    addLink(link: LinkComponentTemplate) {\n        if (!(link.key() in this.recordsHash_)) {\n            var record = new NeighbourRecord(link.peerID(), link.type());\n            this.addRecord_(record);\n        }\n        this.linksHash_[link.key()] = link;\n    }\n\n    findLink(key: string): LinkComponentTemplate {\n        return this.linksHash_[key];\n    }\n\n    links(): Array<LinkComponentTemplate> {\n        return _.reduce(this.linksHash_, (innerContainer: Array<LinkComponentTemplate>, record: LinkComponentTemplate, key: string) => {\n            return innerContainer.concat(record);\n        }, []);\n    }\n\n    neighbours: () => NeighbourHash = () => {\n        return this.recordsHash_;\n    };\n\n    private addLink_(key: string, link: LinkComponentTemplate) {\n        if (this.isEstablished_(key)) this.linksHash_[key].close();\n        this.linksHash_[key] = link;\n    }\n\n    private isEstablished_(key: string): boolean {\n        if (!(key in this.linksHash_)) return false;\n        return this.linksHash_[key].isEstablished();\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/neighbour_store.ts\n **/","// オンライン Peer確立なし 接続要求もなし\n// offlineでpeerjsがconnectedということはあり得ないので枝刈り\n\n/// <reference path=\"../../typings/main.d.ts\" />\n/// <reference path=\"./peerjs_state.ts\" />\n/// <reference path=\"./offline_state.ts\" />\n/// <reference path=\"./connected_state.ts\" />\n\nimport {PeerJsStateEnum, PeerJsStateManager, PeerJsStateIf} from './peerjs_state';\nimport OfflineState from './offline_state';\nimport ConnectedState from './connected_state';\n\nexport default class WaitClosingState implements PeerJsStateIf{\n  state(){ return PeerJsStateEnum.wait_closing };\n\n  network(state: PeerJsStateManager, isOnline: boolean){\n    if(isOnline) state.setStateObject(new ConnectedState());\n  }\n\n  peer(state: PeerJsStateManager, isConnected: boolean){\n    if(!isConnected) state.setStateObject(new OfflineState());\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/states/wait_closing_state.ts\n **/","/*! offline-js 0.7.14 */\n(function(){var a,b,c,d,e,f,g;d=function(a,b){var c,d,e,f;e=[];for(d in b.prototype)try{f=b.prototype[d],null==a[d]&&\"function\"!=typeof f?e.push(a[d]=f):e.push(void 0)}catch(g){c=g}return e},a={},a.options=window.Offline?window.Offline.options||{}:{},c={checks:{xhr:{url:function(){return\"/favicon.ico?_=\"+(new Date).getTime()},timeout:5e3,type:\"HEAD\"},image:{url:function(){return\"/favicon.ico?_=\"+(new Date).getTime()}},active:\"xhr\"},checkOnLoad:!1,interceptRequests:!0,reconnect:!0,deDupBody:!1},e=function(a,b){var c,d,e,f,g,h;for(c=a,h=b.split(\".\"),d=e=0,f=h.length;f>e&&(g=h[d],c=c[g],\"object\"==typeof c);d=++e);return d===h.length-1?c:void 0},a.getOption=function(b){var d,f;return f=null!=(d=e(a.options,b))?d:e(c,b),\"function\"==typeof f?f():f},\"function\"==typeof window.addEventListener&&window.addEventListener(\"online\",function(){return setTimeout(a.confirmUp,100)},!1),\"function\"==typeof window.addEventListener&&window.addEventListener(\"offline\",function(){return a.confirmDown()},!1),a.state=\"up\",a.markUp=function(){return a.trigger(\"confirmed-up\"),\"up\"!==a.state?(a.state=\"up\",a.trigger(\"up\")):void 0},a.markDown=function(){return a.trigger(\"confirmed-down\"),\"down\"!==a.state?(a.state=\"down\",a.trigger(\"down\")):void 0},f={},a.on=function(b,c,d){var e,g,h,i,j;if(g=b.split(\" \"),g.length>1){for(j=[],h=0,i=g.length;i>h;h++)e=g[h],j.push(a.on(e,c,d));return j}return null==f[b]&&(f[b]=[]),f[b].push([d,c])},a.off=function(a,b){var c,d,e,g,h;if(null!=f[a]){if(b){for(e=0,h=[];e<f[a].length;)g=f[a][e],d=g[0],c=g[1],c===b?h.push(f[a].splice(e,1)):h.push(e++);return h}return f[a]=[]}},a.trigger=function(a){var b,c,d,e,g,h,i;if(null!=f[a]){for(g=f[a],i=[],d=0,e=g.length;e>d;d++)h=g[d],b=h[0],c=h[1],i.push(c.call(b));return i}},b=function(a,b,c){var d,e,f,g,h;return h=function(){return a.status&&a.status<12e3?b():c()},null===a.onprogress?(d=a.onerror,a.onerror=function(){return c(),\"function\"==typeof d?d.apply(null,arguments):void 0},g=a.ontimeout,a.ontimeout=function(){return c(),\"function\"==typeof g?g.apply(null,arguments):void 0},e=a.onload,a.onload=function(){return h(),\"function\"==typeof e?e.apply(null,arguments):void 0}):(f=a.onreadystatechange,a.onreadystatechange=function(){return 4===a.readyState?h():0===a.readyState&&c(),\"function\"==typeof f?f.apply(null,arguments):void 0})},a.checks={},a.checks.xhr=function(){var c,d;d=new XMLHttpRequest,d.offline=!1,d.open(a.getOption(\"checks.xhr.type\"),a.getOption(\"checks.xhr.url\"),!0),null!=d.timeout&&(d.timeout=a.getOption(\"checks.xhr.timeout\")),b(d,a.markUp,a.markDown);try{d.send()}catch(e){c=e,a.markDown()}return d},a.checks.image=function(){var b;return b=document.createElement(\"img\"),b.onerror=a.markDown,b.onload=a.markUp,void(b.src=a.getOption(\"checks.image.url\"))},a.checks.down=a.markDown,a.checks.up=a.markUp,a.check=function(){return a.trigger(\"checking\"),a.checks[a.getOption(\"checks.active\")]()},a.confirmUp=a.confirmDown=a.check,a.onXHR=function(a){var b,c,e;return e=function(b,c){var d;return d=b.open,b.open=function(e,f,g,h,i){return a({type:e,url:f,async:g,flags:c,user:h,password:i,xhr:b}),d.apply(b,arguments)}},c=window.XMLHttpRequest,window.XMLHttpRequest=function(a){var b,d,f;return f=new c(a),e(f,a),d=f.setRequestHeader,f.headers={},f.setRequestHeader=function(a,b){return f.headers[a]=b,d.call(f,a,b)},b=f.overrideMimeType,f.overrideMimeType=function(a){return f.mimeType=a,b.call(f,a)},f},d(window.XMLHttpRequest,c),null!=window.XDomainRequest?(b=window.XDomainRequest,window.XDomainRequest=function(){var a;return a=new b,e(a),a},d(window.XDomainRequest,b)):void 0},g=function(){return a.getOption(\"interceptRequests\")&&a.onXHR(function(c){var d;return d=c.xhr,d.offline!==!1?b(d,a.markUp,a.confirmDown):void 0}),a.getOption(\"checkOnLoad\")?a.check():void 0},setTimeout(g,0),window.Offline=a}).call(this),function(){var a,b,c,d,e,f,g,h,i;if(!window.Offline)throw new Error(\"Offline Reconnect brought in without offline.js\");d=Offline.reconnect={},f=null,e=function(){var a;return null!=d.state&&\"inactive\"!==d.state&&Offline.trigger(\"reconnect:stopped\"),d.state=\"inactive\",d.remaining=d.delay=null!=(a=Offline.getOption(\"reconnect.initialDelay\"))?a:3},b=function(){var a,b;return a=null!=(b=Offline.getOption(\"reconnect.delay\"))?b:Math.min(Math.ceil(1.5*d.delay),3600),d.remaining=d.delay=a},g=function(){return\"connecting\"!==d.state?(d.remaining-=1,Offline.trigger(\"reconnect:tick\"),0===d.remaining?h():void 0):void 0},h=function(){return\"waiting\"===d.state?(Offline.trigger(\"reconnect:connecting\"),d.state=\"connecting\",Offline.check()):void 0},a=function(){return Offline.getOption(\"reconnect\")?(e(),d.state=\"waiting\",Offline.trigger(\"reconnect:started\"),f=setInterval(g,1e3)):void 0},i=function(){return null!=f&&clearInterval(f),e()},c=function(){return Offline.getOption(\"reconnect\")&&\"connecting\"===d.state?(Offline.trigger(\"reconnect:failure\"),d.state=\"waiting\",b()):void 0},d.tryNow=h,e(),Offline.on(\"down\",a),Offline.on(\"confirmed-down\",c),Offline.on(\"up\",i)}.call(this),function(){var a,b,c,d,e,f;if(!window.Offline)throw new Error(\"Requests module brought in without offline.js\");c=[],f=!1,d=function(a){return Offline.getOption(\"requests\")!==!1?(Offline.trigger(\"requests:capture\"),\"down\"!==Offline.state&&(f=!0),c.push(a)):void 0},e=function(a){var b,c,d,e,f,g,h,i,j;if(j=a.xhr,g=a.url,f=a.type,h=a.user,d=a.password,b=a.body,Offline.getOption(\"requests\")!==!1){j.abort(),j.open(f,g,!0,h,d),e=j.headers;for(c in e)i=e[c],j.setRequestHeader(c,i);return j.mimeType&&j.overrideMimeType(j.mimeType),j.send(b)}},a=function(){return c=[]},b=function(){var b,d,f,g,h,i,j;if(Offline.getOption(\"requests\")!==!1){for(Offline.trigger(\"requests:flush\"),i={},d=0,g=c.length;g>d;d++)h=c[d],j=h.url.replace(/(\\?|&)_=[0-9]+/,function(a,b){return\"?\"===b?b:\"\"}),Offline.getOption(\"deDupBody\")?(b=h.body,b=\"[object Object]\"===b.toString()?JSON.stringify(b):b.toString(),i[h.type.toUpperCase()+\" - \"+j+\" - \"+b]=h):i[h.type.toUpperCase()+\" - \"+j]=h;for(f in i)h=i[f],e(h);return a()}},setTimeout(function(){return Offline.getOption(\"requests\")!==!1?(Offline.on(\"confirmed-up\",function(){return f?(f=!1,a()):void 0}),Offline.on(\"up\",b),Offline.on(\"down\",function(){return f=!1}),Offline.onXHR(function(a){var b,c,e,f,g;return g=a.xhr,e=a.async,g.offline!==!1&&(f=function(){return d(a)},c=g.send,g.send=function(b){return a.body=b,c.apply(g,arguments)},e)?null===g.onprogress?(g.addEventListener(\"error\",f,!1),g.addEventListener(\"timeout\",f,!1)):(b=g.onreadystatechange,g.onreadystatechange=function(){return 0===g.readyState?f():4===g.readyState&&(0===g.status||g.status>=12e3)&&f(),\"function\"==typeof b?b.apply(null,arguments):void 0}):void 0}),Offline.requests={flush:b,clear:a}):void 0},0)}.call(this),function(){var a,b,c,d,e;if(!Offline)throw new Error(\"Offline simulate brought in without offline.js\");for(d=[\"up\",\"down\"],b=0,c=d.length;c>b;b++)e=d[b],(document.querySelector(\"script[data-simulate='\"+e+\"']\")||(\"undefined\"!=typeof localStorage&&null!==localStorage?localStorage.OFFLINE_SIMULATE:void 0)===e)&&(null==Offline.options&&(Offline.options={}),null==(a=Offline.options).checks&&(a.checks={}),Offline.options.checks.active=e)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!window.Offline)throw new Error(\"Offline UI brought in without offline.js\");b='<div class=\"offline-ui\"><div class=\"offline-ui-content\"></div></div>',a='<a href class=\"offline-ui-retry\"></a>',f=function(a){var b;return b=document.createElement(\"div\"),b.innerHTML=a,b.children[0]},g=e=null,d=function(a){return k(a),g.className+=\" \"+a},k=function(a){return g.className=g.className.replace(new RegExp(\"(^| )\"+a.split(\" \").join(\"|\")+\"( |$)\",\"gi\"),\" \")},i={},h=function(a,b){return d(a),null!=i[a]&&clearTimeout(i[a]),i[a]=setTimeout(function(){return k(a),delete i[a]},1e3*b)},m=function(a){var b,c,d,e;d={day:86400,hour:3600,minute:60,second:1};for(c in d)if(b=d[c],a>=b)return e=Math.floor(a/b),[e,c];return[\"now\",\"\"]},l=function(){var c,h;return g=f(b),document.body.appendChild(g),null!=Offline.reconnect&&Offline.getOption(\"reconnect\")&&(g.appendChild(f(a)),c=g.querySelector(\".offline-ui-retry\"),h=function(a){return a.preventDefault(),Offline.reconnect.tryNow()},null!=c.addEventListener?c.addEventListener(\"click\",h,!1):c.attachEvent(\"click\",h)),d(\"offline-ui-\"+Offline.state),e=g.querySelector(\".offline-ui-content\")},j=function(){return l(),Offline.on(\"up\",function(){return k(\"offline-ui-down\"),d(\"offline-ui-up\"),h(\"offline-ui-up-2s\",2),h(\"offline-ui-up-5s\",5)}),Offline.on(\"down\",function(){return k(\"offline-ui-up\"),d(\"offline-ui-down\"),h(\"offline-ui-down-2s\",2),h(\"offline-ui-down-5s\",5)}),Offline.on(\"reconnect:connecting\",function(){return d(\"offline-ui-connecting\"),k(\"offline-ui-waiting\")}),Offline.on(\"reconnect:tick\",function(){var a,b,c;return d(\"offline-ui-waiting\"),k(\"offline-ui-connecting\"),a=m(Offline.reconnect.remaining),b=a[0],c=a[1],e.setAttribute(\"data-retry-in-value\",b),e.setAttribute(\"data-retry-in-unit\",c)}),Offline.on(\"reconnect:stopped\",function(){return k(\"offline-ui-connecting offline-ui-waiting\"),e.setAttribute(\"data-retry-in-value\",null),e.setAttribute(\"data-retry-in-unit\",null)}),Offline.on(\"reconnect:failure\",function(){return h(\"offline-ui-reconnect-failed-2s\",2),h(\"offline-ui-reconnect-failed-5s\",5)}),Offline.on(\"reconnect:success\",function(){return h(\"offline-ui-reconnect-succeeded-2s\",2),h(\"offline-ui-reconnect-succeeded-5s\",5)})},\"complete\"===document.readyState?j():null!=document.addEventListener?document.addEventListener(\"DOMContentLoaded\",j,!1):(c=document.onreadystatechange,document.onreadystatechange=function(){return\"complete\"===document.readyState&&j(),\"function\"==typeof c?c.apply(null,arguments):void 0})}.call(this);\n\n\n/** WEBPACK FOOTER **\n ** ./bower_components/offline/offline.min.js\n **/"],"sourceRoot":""}